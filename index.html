<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SoccerTR Elite</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* Temel stil */
  body {
    margin:0; padding:0; font-family: 'Roboto', sans-serif;
    background: #1a1a2e; /* Koyu mor-mavi arka plan */
    color: #e0e0e0;
    display: flex; flex-direction: column; height: 100vh;
    overflow: hidden; /* Taşmayı engelle */
  }
  header {
    background: #0f3460; /* Daha koyu mavi */
    padding: 15px;
    text-align: center; font-size: 2.2rem;
    font-weight: 700; /* Kalınlık artırıldı */
    color:#e94560; /* Canlı kırmızı vurgu */
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    letter-spacing: 1px;
  }
  nav {
    display: flex; background: #16213e; /* Bir ton açık */
    justify-content: space-around;
    padding: 5px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  nav button {
    background: transparent; border:none; color:#e0e0e0; padding:12px 18px;
    cursor:pointer; font-weight: 700;
    font-size: 1.05rem;
    transition: background-color 0.3s, color 0.3s, transform 0.2s;
    border-radius: 5px;
  }
  nav button:hover {
    background: rgba(233,69,96,0.2);
    transform: translateY(-2px);
  }
  nav button.active {
    background: #e94560; color:#fff;
    box-shadow: 0 2px 8px rgba(233,69,96,0.5);
    transform: translateY(-2px);
  }
  main {
    flex:1; overflow-y:auto; padding: 20px;
    background: linear-gradient(135deg, #2c3e50, #0f3460); /* Mor-mavi degrade */
    position: relative;
    display: flex; /* Ortalamak için */
    justify-content: center; /* Ortalamak için */
    align-items: flex-start; /* Üste hizalamak için */
  }

  /* Bölümler gizli */
  section {
    display:none;
    padding: 20px;
    background: #16213e; /* Kutu arka planı */
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    width: 90%;
    max-width: 1000px;
    margin-top: 20px; /* main içinde yukarıdan boşluk */
  }
  section.active {
    display:block;
  }

  /* Coin */
  #coinCount {
    font-size: 1.5rem; font-weight: 700;
    margin-bottom: 20px;
    color:#ffd700; /* Altın rengi */
    text-shadow: 0 0 8px rgba(255,215,0,0.6);
    text-align: center;
    background: #0f3460;
    padding: 10px;
    border-radius: 8px;
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }

  /* Kadro bölümü */
  .roster-container {
    display: flex; gap: 20px; flex-wrap: wrap;
    justify-content: center;
  }
  .roster-box {
    background: #0f3460; /* Koyu mavi kutu */
    padding: 20px;
    flex: 1; min-width: 280px; max-width: 350px;
    border-radius: 12px;
    max-height: 500px; overflow-y: auto;
    border: 1px solid rgba(233,69,96,0.3);
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
  }
  .roster-box h3 {
    text-align: center; margin-bottom: 15px;
    color:#e94560;
    border-bottom: 2px solid rgba(233,69,96,0.6);
    padding-bottom: 10px;
    font-size: 1.3rem;
  }
  ul.player-list {
    list-style:none; padding:0; margin:0;
    min-height: 100px; /* Sürükle bırak alanı için */
    flex-grow: 1; /* Listeyi doldur */
  }
  ul.player-list li {
    background: #16213e; /* Daha açık oyuncu kartı */
    margin:8px 0; padding: 10px 15px;
    border-radius: 8px; cursor:grab;
    display:flex; justify-content: space-between;
    align-items:center;
    transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  ul.player-list li:hover {
    background: #2c3e50;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  ul.player-list li.dragging {
    opacity: 0.7;
    transform: scale(1.02);
    box-shadow: 0 6px 15px rgba(0,0,0,0.5);
  }
  .player-info {
    font-size: 0.9rem; color:#b0b0b0;
  }
  button.small-btn {
    padding: 8px 15px; font-size: 0.9rem;
    cursor:pointer; border:none; background:#e94560;
    color:#fff; border-radius: 6px;
    margin-left: 10px;
    transition: background-color 0.2s, transform 0.1s;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  button.small-btn:hover:not(:disabled) {
    background:#d13550;
    transform: translateY(-1px);
  }
  button.small-btn:disabled {
    background:#666; cursor: not-allowed;
    box-shadow: none;
  }

  #increaseRosterBtn {
    display: block;
    width: fit-content;
    margin: 15px auto;
    padding: 10px 20px;
    font-size: 1rem;
    background-color: #5cb85c; /* Yeşil ton */
    color: #fff;
  }
  #increaseRosterBtn:hover:not(:disabled) {
    background-color: #4cae4c;
  }

  /* Paket açma animasyonu */
  #packAnim {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(15,52,96,0.95); /* Koyu mavi, hafif şeffaf */
    padding: 40px 50px;
    border-radius: 15px;
    font-size: 2rem;
    font-weight: bold;
    color: #ffd700; /* Altın rengi */
    box-shadow: 0 0 30px rgba(255,215,0,0.8);
    display: none;
    text-align: center;
    z-index: 1000;
    border: 3px solid #e94560;
    animation: fadeIn 0.5s ease-out;
  }
  #packAnim .ball {
    width: 100px; height: 100px;
    border-radius: 50%;
    background: linear-gradient(45deg, #e94560, #ff8c00); /* Kırmızı-turuncu degrade */
    margin: 25px auto 20px;
    animation: dribble 1.5s infinite ease-in-out;
    box-shadow: 0 0 20px rgba(233,69,96,0.7);
  }
  @keyframes dribble {
    0% { transform: translateY(0) scale(1);}
    50% { transform: translateY(-40px) scale(1.1);}
    100% { transform: translateY(0) scale(1);}
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  /* Genel Form ve Buton Stilleri */
  label {
      display: block;
      margin-bottom: 8px;
      font-size: 1.1rem;
      color: #b0b0b0;
  }
  select, input[type="text"] {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #0f3460;
      background-color: #1a1a2e;
      color: #e0e0e0;
      font-size: 1rem;
  }
  button:not(.small-btn) {
      padding: 12px 25px;
      font-size: 1.1rem;
      background-color: #e94560;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  button:not(.small-btn):hover:not(:disabled) {
      background-color: #d13550;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
  }
  button:not(.small-btn):disabled {
      background-color: #666;
      cursor: not-allowed;
      box-shadow: none;
  }

  /* Maç alanı */
  #matchArea {
    background: #008000; /* Yeşil çim rengi */
    border: 5px solid #005000; /* Koyu yeşil sınır */
    border-radius: 15px;
    position: relative;
    width: 100%;
    max-width: 800px; /* Alan genişliği artırıldı */
    height: 450px;
    margin: 20px auto;
    overflow: hidden;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.6);
    background: linear-gradient(to bottom, #008000, #006400); /* Hafif degrade */
  }
  /* Orta çizgi */
  #matchArea::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    width: 4px;
    height: 100%;
    background-color: rgba(255,255,255,0.7);
    transform: translateX(-50%);
    border-radius: 2px;
  }
  /* Orta daire */
  #matchArea::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    width: 120px; height: 120px;
    border: 4px solid rgba(255,255,255,0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
  }
  .goal-area {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 60px; /* Kale alanı derinliği */
    height: 160px; /* Kale genişliği */
    border: 4px solid rgba(255,255,255,0.7);
    border-radius: 5px;
    box-sizing: border-box; /* padding/border dahil */
  }
  .goal-area-left {
      left: 0;
      border-left: none;
  }
  .goal-area-right {
      right: 0;
      border-right: none;
  }
  .goal-post { /* Kaleler */
      position: absolute;
      width: 20px;
      height: 60px; /* Kale direklerinin uzunluğu */
      background-color: #fff;
      border-radius: 3px;
      z-index: 2;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
  }
  .goal-post.left-top { top: calc(50% - 80px); left: -20px; }
  .goal-post.left-bottom { top: calc(50% + 20px); left: -20px; }
  .goal-post.right-top { top: calc(50% - 80px); right: -20px; }
  .goal-post.right-bottom { top: calc(50% + 20px); right: -20px; }


  #player, #bot, #ball {
    position: absolute;
    width: 45px; height: 45px; /* Boyutlar hafifçe büyütüldü */
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; color: white;
    user-select: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    transition: transform 0.1s ease-out; /* Hareket animasyonu */
  }
  #player {
    background: #3f88c5; /* Mavi takım */
    left: 100px; top: 200px;
    z-index: 10;
    border: 2px solid #57a0d3;
  }
  #bot {
    background: #e63946; /* Kırmızı takım */
    right: 100px; top: 200px;
    z-index: 10;
    border: 2px solid #f25c54;
  }
  #ball {
    background: radial-gradient(circle at 30% 30%, #f0f0f0, #a0a0a0); /* Gri tonları, hafif parlama */
    width: 28px; height: 28px; /* Top boyutu küçültüldü */
    top: calc(50% - 14px); left: calc(50% - 14px); /* Ortaya hizalandı */
    z-index: 8;
    border: 2px solid #333;
    transition: transform 0.1s ease-out; /* Vuruş animasyonu */
  }
  #ball.shot-anim { /* Vuruş animasyonu sınıfı */
      animation: shotEffect 0.2s forwards;
  }
  @keyframes shotEffect {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
  }


  /* Vuruş gücü barı */
  #powerBarContainer {
    position: absolute;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    width: 350px; height: 25px; /* Daha belirgin */
    background: #333;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid #555;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
  }
  #powerBar {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #4CAF50, #FFEB3B, #F44336); /* Yeşil-sarı-kırmızı */
    transition: width 0.05s linear; /* Daha hızlı geçiş */
  }

  /* Joystick container */
  #joystickContainer {
    position: absolute;
    bottom: 40px; left: 20px;
    width: 140px; height: 140px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    touch-action: none;
    user-select: none;
    display: none; /* Varsayılan olarak gizli, mobil için açılır */
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  #joystick {
    position: absolute;
    width: 70px; height: 70px;
    background: #e94560;
    border-radius: 50%;
    top: 35px; left: 35px;
    touch-action: none;
    user-select: none;
    box-shadow: 0 0 15px rgba(233,69,96,0.7);
  }
  /* Vur tuşu mobil */
  #kickBtn {
    position: absolute;
    bottom: 60px; right: 40px;
    width: 90px; height: 90px; /* Daha büyük */
    background: #5cb85c; /* Yeşil */
    border-radius: 50%;
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
    display: none; /* Varsayılan olarak gizli, mobil için açılır */
    user-select: none;
    border: none;
    box-shadow: 0 0 20px rgba(92,184,92,0.8);
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
  }
  #kickBtn:active {
      transform: scale(0.95);
      box-shadow: 0 0 10px rgba(92,184,92,0.8);
  }

  #matchInfo {
    text-align: center;
    margin-top: 15px;
    font-size: 1.3rem;
    font-weight: 700;
    color: #fff;
    background: rgba(15,52,96,0.8);
    padding: 10px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }
  #scoreDisplay {
    font-size: 1.8rem;
    color: #ffd700;
    margin-bottom: 8px;
    text-shadow: 0 0 5px rgba(255,215,0,0.7);
  }
  #timerDisplay {
    font-size: 1.4rem;
    color: #e0e0e0;
  }
  #matchMsg {
      font-size: 1.1rem;
      margin-top: 10px;
      color: #add8e6; /* Açık mavi */
  }

  #matchOptions {
    text-align: center;
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 20px;
  }
  #matchOptions button {
    padding: 15px 30px;
    font-size: 1.2rem;
    background-color: #e94560;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  #matchOptions button:hover {
    background-color: #d13550;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
  }

  #restartMatchBtn {
    display: block;
    margin: 30px auto 0;
    padding: 15px 30px;
    font-size: 1.1rem;
    background-color: #5cb85c;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    display: none; /* Maç bittiğinde görünür */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  #restartMatchBtn:hover {
    background-color: #4cae4c;
    transform: translateY(-2px);
  }

  /* Responsive */
  @media (max-width: 768px) {
    header { font-size: 1.8rem; padding: 10px; }
    nav button { font-size: 0.9rem; padding: 10px 8px; }
    main { padding: 10px; }
    section { padding: 15px; max-width: 95%; margin-top: 10px; }
    #coinCount { font-size: 1.2rem; padding: 8px; }
    .roster-box { min-width: unset; width: 100%; max-width: unset; }
    .roster-container { flex-direction: column; align-items: center; gap: 15px; }
    ul.player-list li { font-size: 0.9rem; padding: 8px 10px; }
    button.small-btn { padding: 6px 12px; font-size: 0.8rem; }
    #packAnim { padding: 30px; font-size: 1.5rem; }
    #packAnim .ball { width: 80px; height: 80px; }
    select, input[type="text"], button:not(.small-btn) { font-size: 1rem; padding: 10px; }

    #matchArea {
      height: 350px;
      max-width: 95%;
      margin: 10px auto;
    }
    #player, #bot {
      width: 35px; height: 35px;
      font-size: 0.9rem;
    }
    #ball {
      width: 24px; height: 24px;
      top: calc(50% - 12px); left: calc(50% - 12px);
    }
    #joystickContainer, #kickBtn {
        display: block; /* Mobil cihazlarda görünür */
    }
    #joystickContainer {
      width: 120px; height: 120px;
      bottom: 20px; left: 10px;
    }
    #joystick {
      width: 60px; height: 60px;
      top: 30px; left: 30px;
    }
    #kickBtn {
      width: 80px; height: 80px;
      font-size: 1.5rem;
      bottom: 30px; right: 20px;
    }
    #powerBarContainer {
      width: 250px; height: 20px;
      bottom: 10px;
    }
    #matchInfo {
      font-size: 1.1rem;
      padding: 8px 15px;
      margin-top: 10px;
    }
    #scoreDisplay { font-size: 1.5rem; }
    #timerDisplay { font-size: 1.2rem; }
    #matchMsg { font-size: 1rem; }
    #matchOptions button { padding: 12px 25px; font-size: 1.1rem; }
    #restartMatchBtn { padding: 12px 25px; font-size: 1rem; margin-top: 20px; }
    .goal-area { width: 40px; height: 120px; } /* Mobil için kale boyutu */
    .goal-post { width: 15px; height: 45px; }
    .goal-post.left-top { top: calc(50% - 60px); left: -15px; }
    .goal-post.left-bottom { top: calc(50% + 15px); left: -15px; }
    .goal-post.right-top { top: calc(50% - 60px); right: -15px; }
    .goal-post.right-bottom { top: calc(50% + 15px); right: -15px; }
  }
</style>
</head>
<body>

<header>SoccerTR Elite</header>
<nav>
    <button id="btnRoster" class="active">Kadro</button>
    <button id="btnPack">Paket Aç</button>
    <button id="btnTraining">Antrenman</button>
    <button id="btnMatch">Maç</button>
    <button id="btnSettings">Ayarlar</button>
</nav>

<main>
    <div id="coinCount">Coin: 100</div>

    <section id="rosterSection" class="active">
        <button id="increaseRosterBtn" class="small-btn">Kadro Dışını +100 (100 Coin)</button>
        <div class="roster-container">
            <div class="roster-box">
                <h3>İlk 11 (<span id="first11Count">0</span>/11)</h3>
                <ul id="first11" class="player-list" data-list="first11"></ul>
            </div>
            <div class="roster-box">
                <h3>Yedek (<span id="substitutesCount">0</span>/11)</h3>
                <ul id="substitutes" class="player-list" data-list="substitutes"></ul>
            </div>
            <div class="roster-box">
                <h3>Kadro Dışı (<span id="rosterOutCount">0</span>/<span id="rosterLimitCount">500</span>)</h3>
                <ul id="rosterOut" class="player-list" data-list="rosterOut"></ul>
            </div>
        </div>
    </section>

    <section id="packSection">
        <h2>Paket Aç</h2>
        <p>100 Coin karşılığında rastgele bir ligden oyuncu kazan!</p>
        <label for="leagueSelect">Lig Seç:</label>
        <select id="leagueSelect">
            <option value="">Lig seçiniz...</option>
            <option value="mls">MLS</option>
            <option value="premier">Premier Lig</option>
            <option value="bundesliga">Bundesliga</option>
            <option value="laliga">La Liga</option>
            <option value="ligue1">Ligue 1</option>
            <option value="seriea">Serie A</option>
            <option value="superlig">Süper Lig</option>
            <option value="saudiprolig">Suudi Pro Lig</option>
        </select>
        <button id="openPackBtn" disabled>Paket Aç (100 Coin)</button>
        <div id="packAnim">
            <div class="ball"></div>
            <div id="packAnimText"></div>
        </div>
    </section>

    <section id="trainingSection">
        <h2>Antrenman</h2>
        <p>Oyuncularınızı geliştirerek ratinglerini artırın.</p>
        <label for="trainSelect">Oyuncu Seç:</label>
        <select id="trainSelect">
            <option value="">Oyuncu seçiniz...</option>
        </select>
        <div style="margin-top: 15px; display: flex; gap: 15px; justify-content: center;">
            <button id="normalTrainBtn" disabled>Normal Antrenman (Ücretsiz)</button>
            <button id="playerTrainBtn" disabled>Özel Antrenman (Ücretsiz)</button>
        </div>
        <div id="trainMsg" style="margin-top:20px; font-weight:bold; text-align: center; font-size: 1.1rem;"></div>
    </section>

    <section id="matchSection">
        <h2>Maç</h2>
        <div id="matchOptions">
            <button id="start1v1MatchBtn">1 vs 1 Maç Başlat</button>
            <button id="start11v11MatchBtn">11 vs 11 Maç Başlat</button>
        </div>

        <div id="matchInfo" style="display:none;">
            <div id="scoreDisplay">Senin Takımın 0 - 0 Bot Takımı</div>
            <div id="timerDisplay">Süre: 02:00</div>
            <div id="matchMsg" style="margin-top:5px;"></div>
        </div>

        <div id="matchArea" style="display:none;">
            <div class="goal-area goal-area-left">
                <div class="goal-post left-top"></div>
                <div class="goal-post left-bottom"></div>
            </div>
            <div class="goal-area goal-area-right">
                <div class="goal-post right-top"></div>
                <div class="goal-post right-bottom"></div>
            </div>
            <div id="player">P</div>
            <div id="bot">B</div>
            <div id="ball"></div>
            <div id="joystickContainer">
                <div id="joystick"></div>
            </div>
            <button id="kickBtn">VUR</button>
            <div id="powerBarContainer">
                <div id="powerBar"></div>
            </div>
        </div>
        <button id="restartMatchBtn">Maçı Yeniden Başlat</button>
    </section>

    <section id="settingsSection">
        <h2>Ayarlar</h2>
        <label for="languageSelect">Dil Seçimi:</label>
        <select id="languageSelect">
            <option value="tr">Türkçe</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
            <option value="ru">Русский</option>
            <option value="pt">Português</option>
        </select>
        <br/><br/>
        <label>Tema:</label><br/>
        <input type="radio" id="themeDefault" name="theme" value="default" checked><label for="themeDefault">Varsayılan</label><br/>
        <input type="radio" id="themeDark" name="theme" value="dark"><label for="themeDark">Koyu</label><br/>
        <input type="radio" id="themeLight" name="theme" value="light"><label for="themeLight">Açık</label>
    </section>
</main>

<script>
(() => {
    // Oyuncu örnek verisi (gerçek oyuncu isimleri ve ligler)
    const ligPaketleri = {
        mls: ["Zlatan Ibrahimovic", "Josef Martínez", "Carlos Vela", "Chicharito", "Gonzalo Higuaín", "Wayne Rooney", "Héctor Herrera", "Lorenzo Insigne", "Gareth Bale", "Giorgio Chiellini"],
        premier: ["Mohamed Salah", "Harry Kane", "Kevin De Bruyne", "Erling Haaland", "Bukayo Saka", "Marcus Rashford", "Declan Rice", "Martin Ødegaard", "Virgil van Dijk", "Alisson Becker"],
        bundesliga: ["Harry Kane", "Jamal Musiala", "Florian Wirtz", "Jude Bellingham", "Leroy Sané", "Joshua Kimmich", "Manuel Neuer", "Christopher Nkunku", "Matthijs de Ligt", "Patrik Schick"],
        laliga: ["Vinicius Jr", "Jude Bellingham", "Robert Lewandowski", "Antoine Griezmann", "Marc-André ter Stegen", "Federico Valverde", "Ronald Araújo", "Pedri", "Gavi", "Eder Militão"],
        ligue1: ["Kylian Mbappé", "Achraf Hakimi", "Gianluigi Donnarumma", "Marquinhos", "Ousmane Dembélé", "Vitória", "Warren Zaïre-Emery", "Jonathan David", "Alexandre Lacazette", "Bradley Barcola"],
        seriea: ["Victor Osimhen", "Khvicha Kvaratskhelia", "Lautaro Martínez", "Rafael Leão", "Nicolò Barella", "Federico Dimarco", "Theo Hernández", "Mike Maignan", "Paulo Dybala", "Dusan Vlahović"],
        superlig: ["Mauro Icardi", "Dries Mertens", "Fenerbahçe (Genel)", "Galatasaray (Genel)", "Beşiktaş (Genel)", "Trabzonspor (Genel)", "Edin Džeko", "Dušan Tadić", "Fred", "Lucas Torreira", "Kerem Aktürkoğlu"],
        saudiprolig: ["Cristiano Ronaldo", "Karim Benzema", "Neymar Jr", "Sadio Mané", "Riyad Mahrez", "Marcelo Brozović", "Sergej Milinković-Savić", "Fabinho", "Kalidou Koulibaly", "Ruben Neves"]
    };

    let coin = 500; // Başlangıç coini artırıldı
    let rosterLimit = 500; // Kadro dışı limit başlangıç

    let players = []; // Tüm oyuncular kadro dışı dahil
    let first11 = [];
    let substitutes = [];
    let rosterOut = [];

    // IDs için otomatik artan
    let nextId = 1;

    // DOM elemanları
    const coinCountEl = document.getElementById("coinCount");
    const btnRoster = document.getElementById("btnRoster");
    const btnPack = document.getElementById("btnPack");
    const btnTraining = document.getElementById("btnTraining");
    const btnMatch = document.getElementById("btnMatch");
    const btnSettings = document.getElementById("btnSettings");

    const rosterSection = document.getElementById("rosterSection");
    const packSection = document.getElementById("packSection");
    const trainingSection = document.getElementById("trainingSection");
    const matchSection = document.getElementById("matchSection");
    const settingsSection = document.getElementById("settingsSection");

    const first11List = document.getElementById("first11");
    const first11CountEl = document.getElementById("first11Count");
    const subsList = document.getElementById("substitutes");
    const substitutesCountEl = document.getElementById("substitutesCount");
    const rosterOutList = document.getElementById("rosterOut");
    const rosterOutCountEl = document.getElementById("rosterOutCount");
    const rosterLimitCountEl = document.getElementById("rosterLimitCount");
    const increaseRosterBtn = document.getElementById("increaseRosterBtn");

    const leagueSelect = document.getElementById("leagueSelect");
    const openPackBtn = document.getElementById("openPackBtn");
    const packAnim = document.getElementById("packAnim");
    const packAnimText = document.getElementById("packAnimText");

    const trainSelect = document.getElementById("trainSelect");
    const normalTrainBtn = document.getElementById("normalTrainBtn");
    const playerTrainBtn = document.getElementById("playerTrainBtn");
    const trainMsg = document.getElementById("trainMsg");

    const matchOptions = document.getElementById("matchOptions");
    const start1v1MatchBtn = document.getElementById("start1v1MatchBtn");
    const start11v11MatchBtn = document.getElementById("start11v11MatchBtn");
    const matchInfo = document.getElementById("matchInfo");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const timerDisplay = document.getElementById("timerDisplay");
    const matchArea = document.getElementById("matchArea");
    const playerEl = document.getElementById("player");
    const botEl = document.getElementById("bot");
    const ballEl = document.getElementById("ball");
    const joystickContainer = document.getElementById("joystickContainer");
    const joystick = document.getElementById("joystick");
    const kickBtn = document.getElementById("kickBtn");
    const powerBar = document.getElementById("powerBar");
    const matchMsg = document.getElementById("matchMsg");
    const restartMatchBtn = document.getElementById("restartMatchBtn");

    const languageSelect = document.getElementById("languageSelect");
    const themeRadios = document.querySelectorAll('input[name="theme"]');

    // Menü geçiş fonksiyonu
    function showSection(section) {
        [rosterSection, packSection, trainingSection, matchSection, settingsSection].forEach(s => s.classList.remove("active"));
        [btnRoster, btnPack, btnTraining, btnMatch, btnSettings].forEach(b => b.classList.remove("active"));

        // Maç modundan çıkarken gerekli elementleri gizle/göster
        matchArea.style.display = 'none';
        matchInfo.style.display = 'none';
        matchOptions.style.display = 'flex';
        restartMatchBtn.style.display = 'none';
        endMatch(); // Maç aktifse bitir

        if(section==="roster"){ rosterSection.classList.add("active"); btnRoster.classList.add("active"); }
        else if(section==="pack"){ packSection.classList.add("active"); btnPack.classList.add("active"); }
        else if(section==="training"){ trainingSection.classList.add("active"); btnTraining.classList.add("active"); }
        else if(section==="match"){ matchSection.classList.add("active"); btnMatch.classList.add("active"); }
        else if(section==="settings"){ settingsSection.classList.add("active"); btnSettings.classList.add("active"); }
    }

    btnRoster.onclick = () => showSection('roster');
    btnPack.onclick = () => showSection('pack');
    btnTraining.onclick = () => showSection('training');
    btnMatch.onclick = () => showSection('match');
    btnSettings.onclick = () => showSection('settings');

    // Coin güncelle
    function updateCoin() {
        coinCountEl.textContent = `Coin: ${coin}`;
    }

    // Kadro listelerini güncelle
    function updateRosterLists() {
        first11List.innerHTML = "";
        subsList.innerHTML = "";
        rosterOutList.innerHTML = "";

        // First11'deki oyuncuları doldur
        first11.forEach(player => first11List.appendChild(createPlayerLi(player)));
        // Yedeklerdeki oyuncuları doldur
        substitutes.forEach(player => subsList.appendChild(createPlayerLi(player)));
        // Kadro dışındaki oyuncuları doldur
        rosterOut.forEach(player => rosterOutList.appendChild(createPlayerLi(player)));

        first11CountEl.textContent = first11.length;
        substitutesCountEl.textContent = substitutes.length;
        rosterOutCountEl.textContent = rosterOut.length;
        rosterLimitCountEl.textContent = rosterLimit;

        updateTrainingSelect(); // Antrenman selectbox'ını da güncelle
    }

    function createPlayerLi(player) {
        const li = document.createElement("li");
        li.className = "player-item";
        li.innerHTML = `
            <span class="player-name">${player.name}</span>
            <span class="player-info">Rating: ${player.rating} | Gol: ${player.goals} | Asist: ${player.assists}</span>
        `;
        li.draggable = true; // Sürüklenebilir yap
        li.dataset.playerId = player.id; // Oyuncu ID'sini sakla

        return li;
    }

    // Kadro listeleri için sürükle-bırak işlevselliği
    let draggedPlayerId = null;

    document.querySelectorAll('.player-list').forEach(list => {
        list.addEventListener('dragstart', (e) => {
            // Sadece li elementi sürüklenebilir olsun
            if (e.target.tagName === 'LI') {
                draggedPlayerId = parseInt(e.target.dataset.playerId);
                e.target.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                // Drag image için boş bir element oluşturabiliriz, aksi halde varsayılan görsel kullanılacak
                const dragImg = document.createElement('div');
                dragImg.style.width = '1px';
                dragImg.style.height = '1px';
                e.dataTransfer.setDragImage(dragImg, 0, 0);
            } else {
                e.preventDefault(); // Başka bir yere tıklanırsa sürüklemeyi engelle
            }
        });

        list.addEventListener('dragover', (e) => {
            e.preventDefault(); // Bırakmaya izin ver
            e.dataTransfer.dropEffect = 'move';
        });

        list.addEventListener('dragleave', (e) => {
            e.preventDefault();
        });

        list.addEventListener('drop', (e) => {
            e.preventDefault();
            const targetListId = e.currentTarget.dataset.list;
            
            const player = players.find(p => p.id === draggedPlayerId);
            if (!player) return;

            // Oyuncuyu mevcut konumundan çıkar
            const currentList = 
                first11.find(p => p.id === player.id) ? first11 :
                substitutes.find(p => p.id === player.id) ? substitutes :
                rosterOut.find(p => p.id === player.id) ? rosterOut : null;
            
            if (currentList) {
                currentList.splice(currentList.indexOf(player), 1);
            }

            // Yeni listeye ekle
            if (targetListId === 'first11') {
                if (first11.length < 11) {
                    first11.push(player);
                } else {
                    alert("İlk 11 dolu! Lütfen bir oyuncuyu başka bir listeye taşıyın.");
                    // Oyuncuyu eski listesine geri ekle
                    if(currentList) currentList.push(player); 
                }
            } else if (targetListId === 'substitutes') {
                 if (substitutes.length < 11) {
                    substitutes.push(player);
                } else {
                    alert("Yedekler dolu! Lütfen bir oyuncuyu başka bir listeye taşıyın.");
                    if(currentList) currentList.push(player);
                }
            } else if (targetListId === 'rosterOut') {
                if (rosterOut.length < rosterLimit) {
                    rosterOut.push(player);
                } else {
                    alert("Kadro dışı limiti dolu! Limiti artırın veya bir oyuncu silin.");
                    if(currentList) currentList.push(player);
                }
            }
            updateRosterLists();
        });

        list.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('dragging')) {
                e.target.classList.remove('dragging');
            }
            draggedPlayerId = null;
        });
    });

    // Kadro dışı arttırma
    increaseRosterBtn.onclick = () => {
        if(coin < 100) {
            alert("Yeterli coin yok!");
            return;
        }
        rosterLimit += 100;
        coin -= 100;
        updateCoin();
        updateRosterLists();
        alert(`Kadro dışı limiti +100 oldu: ${rosterLimit}`);
    };

    // Paket açma butonu durumu
    leagueSelect.onchange = () => {
        openPackBtn.disabled = leagueSelect.value === "";
        packAnim.style.display = "none";
    };

    // Paket açma animasyonu
    function showPackAnimation(playerName) {
        packAnimText.textContent = `${playerName} oyuncusu kazandınız!`;
        packAnim.style.display = "block";
        packAnim.classList.add('active'); // Animasyon için sınıf ekle

        setTimeout(() => {
            packAnim.style.display = "none";
            packAnim.classList.remove('active');
        }, 3500); // Animasyon süresi
    }

    // Paket açma
    openPackBtn.onclick = () => {
        if(coin < 100) {
            alert("Yeterli coin yok!");
            return;
        }
        const lig = leagueSelect.value;
        const pool = ligPaketleri[lig];
        if(!pool) return;

        // Halihazırda sahip olunan oyuncuları çıkar (sadece rosterOut içindekiler değil, tüm players içinde)
        const available = pool.filter(name => !players.some(p => p.name === name));
        if(available.length === 0) {
            alert("Bu ligde tüm oyuncular sizde var veya oyuncu havuzu boş! Farklı bir lig deneyin.");
            return;
        }
        
        // Kadro dışı limit kontrolü
        if(rosterOut.length >= rosterLimit) {
            alert("Kadro dışı limiti dolu. Lütfen kadro dışını arttırın (Kadro bölümünde).");
            return;
        }

        coin -= 100;
        updateCoin();

        // Rastgele oyuncu seçimi
        const selectedName = available[Math.floor(Math.random() * available.length)];
        const newPlayer = {
            id: nextId++,
            name: selectedName,
            rating: Math.floor(Math.random() * 20) + 70, // 70-89 arası
            goals: 0,
            assists: 0
        };

        players.push(newPlayer);
        rosterOut.push(newPlayer); // Yeni oyuncuyu otomatik kadro dışına ekle

        showPackAnimation(selectedName);

        setTimeout(() => {
            updateRosterLists();
        }, 3500); // Animasyon bitince listeyi güncelle
    };

    // Antrenman seçimi güncelle
    function updateTrainingSelect() {
        trainSelect.innerHTML = '<option value="">Oyuncu seçiniz...</option>';
        players.forEach(p => {
            const option = document.createElement("option");
            option.value = p.id;
            option.textContent = `${p.name} (Rating: ${p.rating})`;
            trainSelect.appendChild(option);
        });
        normalTrainBtn.disabled = true;
        playerTrainBtn.disabled = true;
        trainMsg.textContent = "";
    }

    trainSelect.onchange = () => {
        normalTrainBtn.disabled = !trainSelect.value;
        playerTrainBtn.disabled = !trainSelect.value;
        trainMsg.textContent = "";
    };

    // Normal antrenman ücretsiz
    normalTrainBtn.onclick = () => {
        const pid = parseInt(trainSelect.value);
        const player = players.find(p => p.id === pid);
        if(!player) return;
        if (player.rating >= 100) {
            trainMsg.style.color = "yellow";
            trainMsg.textContent = `${player.name} zaten en yüksek rating'de!`;
            return;
        }
        const inc = Math.floor(Math.random() * 3) + 1; // 1-3 artış
        player.rating = Math.min(100, player.rating + inc);
        trainMsg.style.color = "lightgreen";
        trainMsg.textContent = `${player.name} normal antrenmanla +${inc} rating kazandı! Şimdi: ${player.rating}`;
        updateRosterLists();
        updateTrainingSelect();
    };

    // Oyuncu antrenmanı ücretsiz
    playerTrainBtn.onclick = () => {
        const pid = parseInt(trainSelect.value);
        const player = players.find(p => p.id === pid);
        if(!player) return;
        if (player.rating >= 100) {
            trainMsg.style.color = "yellow";
            trainMsg.textContent = `${player.name} zaten en yüksek rating'de!`;
            return;
        }
        const inc = Math.floor(Math.random() * 5) + 2; // 2-6 artış
        player.rating = Math.min(100, player.rating + inc);

        // %30 gol, %20 asist şansı
        let msg = `${player.name} özel antrenmanla +${inc} rating aldı! Şimdi: ${player.rating}`;
        const rand = Math.random();
        if(rand < 0.3) {
            player.goals++;
            msg += " ⚽ Gol attı!";
        } else if(rand < 0.5) { // %20 şans (0.3 ile 0.5 arası)
            player.assists++;
            msg += " 🅰️ Asist yaptı!";
        }
        trainMsg.style.color = "orange";
        trainMsg.textContent = msg;
        updateRosterLists();
        updateTrainingSelect();
    };

    // Maç modu değişkenleri
    let matchActive = false;
    let playerPos = {x:0, y:0};
    let botPos = {x:0, y:0};
    let ballPos = {x:0, y:0};
    let ballVelocity = {x:0, y:0}; // Topun hızı ve yönü
    const ballBaseSpeedFactor = 5; // Topun temel hızı
    const playerSpeed = 4; // Oyuncu hızı artırıldı
    const botSpeed = 3.5; // Bot hızı (biraz daha yavaş)
    let keysPressed = {};
    let power = 0;
    let powerIncreasing = false;

    let playerScore = 0;
    let botScore = 0;
    let matchTime = 120; // 2 dakika (saniye cinsinden)
    let matchInterval = null; // setInterval id'si
    let currentMatchMode = '1v1'; // Başlangıçta 1v1

    // Maç alanının boyutları dinamik olarak alınacak
    let matchAreaWidth = 0;
    let matchAreaHeight = 0;
    let playerWidth = 0;
    let ballWidth = 0;
    // Kale koordinatları
    const goalWidth = 20; // Kale direkleri arasındaki boşluk
    const goalHeight = 160; // Kale yüksekliği (CSS'deki goal-area height ile aynı)

    // Vuruş güç barı güncelle
    function updatePowerBar() {
        powerBar.style.width = power + "%";
    }

    // Skor ekranını güncelle
    function updateScoreDisplay() {
        scoreDisplay.textContent = `Senin Takımın ${playerScore} - ${botScore} Bot Takımı`;
    }

    // Zamanlayıcıyı güncelle
    function updateTimerDisplay() {
        const minutes = Math.floor(matchTime / 60).toString().padStart(2, '0');
        const seconds = (matchTime % 60).toString().padStart(2, '0');
        timerDisplay.textContent = `Süre: ${minutes}:${seconds}`;
    }

    // Topu orta sahaya sıfırla
    function resetBall() {
        ballPos = {
            x: matchAreaWidth / 2 - ballWidth / 2,
            y: matchAreaHeight / 2 - ballWidth / 2
        };
        ballVelocity = {x:0, y:0}; // Topun hızını sıfırla
        updatePositions();
        matchMsg.textContent = "Maça devam!";
    }

    // Gol kontrolü
    function checkGoal() {
        // Sol kale (Botun kalesi)
        const leftGoalX = 0;
        const leftGoalY_top = matchAreaHeight / 2 - goalHeight / 2;
        const leftGoalY_bottom = matchAreaHeight / 2 + goalHeight / 2;

        if (ballPos.x <= leftGoalX + ballWidth/2 && ballPos.y > leftGoalY_top && ballPos.y < leftGoalY_bottom) {
            playerScore++;
            updateScoreDisplay();
            matchMsg.textContent = "GOOOL! 🎉";
            // Gol atan oyuncuya +1 gol ekle (rastgele ilk11 oyuncusu)
            if (currentMatchMode === '11v11' && first11.length > 0) {
                const scorer = first11[Math.floor(Math.random()*first11.length)];
                scorer.goals++;
                updateRosterLists();
            }
            setTimeout(resetBall, 1500); // 1.5 saniye sonra topu sıfırla
            return true;
        }

        // Sağ kale (Senin kalen)
        const rightGoalX = matchAreaWidth - ballWidth;
        const rightGoalY_top = matchAreaHeight / 2 - goalHeight / 2;
        const rightGoalY_bottom = matchAreaHeight / 2 + goalHeight / 2;

        if (ballPos.x + ballWidth >= rightGoalX - ballWidth/2 && ballPos.y > rightGoalY_top && ballPos.y < rightGoalY_bottom) {
            botScore++;
            updateScoreDisplay();
            matchMsg.textContent = "GOL YEDİN! 😩";
            setTimeout(resetBall, 1500); // 1.5 saniye sonra topu sıfırla
            return true;
        }
        return false;
    }

    // Maç başlat
    function startMatch(mode) {
        if (mode === '11v11' && first11.length < 11) {
            alert("11 vs 11 maç için İlk 11'de 11 oyuncun olmalı!");
            return;
        }

        currentMatchMode = mode;
        matchActive = true;
        playerScore = 0;
        botScore = 0;
        matchTime = 120; // 2 dakika
        updateScoreDisplay();
        updateTimerDisplay();
        matchMsg.textContent = "Maç başladı!";
        
        matchOptions.style.display = 'none';
        matchArea.style.display = 'block';
        matchInfo.style.display = 'block';
        restartMatchBtn.style.display = 'none';

        // Boyutları al (Maç alanı görünür olduğunda)
        matchAreaWidth = matchArea.clientWidth;
        matchAreaHeight = matchArea.clientHeight;
        playerWidth = playerEl.clientWidth;
        ballWidth = ballEl.clientWidth;

        // Başlangıç pozisyonları
        playerPos = {x: 100, y: matchAreaHeight / 2 - playerWidth / 2};
        botPos = {x: matchAreaWidth - 100 - playerWidth, y: matchAreaHeight / 2 - playerWidth / 2};
        resetBall(); // Topu ortaya sıfırla

        // Zamanlayıcıyı başlat
        clearInterval(matchInterval);
        matchInterval = setInterval(() => {
            matchTime--;
            updateTimerDisplay();
            if (matchTime <= 0) {
                endMatch();
            }
        }, 1000);

        // PC için klavye dinle
        window.addEventListener("keydown", keyDownHandler);
        window.addEventListener("keyup", keyUpHandler);

        // Oyun döngülerini başlat (bir kez çağrılacak)
        startGameLoops();
    }

    start1v1MatchBtn.onclick = () => startMatch('1v1');
    start11v11MatchBtn.onclick = () => startMatch('11v11');
    restartMatchBtn.onclick = () => {
        showSection('match'); // Maç bölümüne geri dönerek seçenekleri göster
    };

    // Maç sonu
    function endMatch() {
        if (!matchActive) return;
        matchActive = false;
        clearInterval(matchInterval);
        window.removeEventListener("keydown", keyDownHandler);
        window.removeEventListener("keyup", keyUpHandler);
        
        let finalMsg = "";
        if (playerScore > botScore) {
            finalMsg = "Maçı KAZANDIN! 🎉";
            coin += 200; // Galibiyet ödülü
        } else if (botScore > playerScore) {
            finalMsg = "Maçı KAYBETTİN! 😩";
        } else {
            finalMsg = "Maç BERABERE! 🤝";
            coin += 50; // Beraberlik ödülü
        }
        updateCoin();
        matchMsg.textContent = finalMsg + " Tekrar denemek için 'Maçı Yeniden Başlat'a tıkla.";
        matchArea.style.display = 'none';
        matchInfo.style.display = 'block';
        restartMatchBtn.style.display = 'block';
        power = 0;
        updatePowerBar();
    }

    // Pozisyon güncelle
    function updatePositions() {
        playerEl.style.left = playerPos.x + "px";
        playerEl.style.top = playerPos.y + "px";
        botEl.style.left = botPos.x + "px";
        botEl.style.top = botPos.y + "px";
        ballEl.style.left = ballPos.x + "px";
        ballEl.style.top = ballPos.y + "px";
    }

    // Klavye tuşları
    function keyDownHandler(e) {
        if(!matchActive) return;
        keysPressed[e.key.toLowerCase()] = true;
        if(e.key === " ") {
            e.preventDefault();
            startPowerCharge();
        }
    }
    function keyUpHandler(e) {
        if(!matchActive) return;
        keysPressed[e.key.toLowerCase()] = false;
        if(e.key === " ") {
            stopPowerCharge();
        }
    }

    // Power şarj mekanizması
    let powerChargeInterval = null;
    function startPowerCharge() {
        if(powerIncreasing) return;
        powerIncreasing = true;
        power = 0;
        powerChargeInterval = setInterval(() => {
            power += 3; // Şarj hızı artırıldı
            if(power > 100) power = 0; // %100'ü geçerse sıfırla
            updatePowerBar();
        }, 30); // Daha hızlı güncelleme
    }
    function stopPowerCharge() {
        if(!powerIncreasing) return;
        powerIncreasing = false;
        clearInterval(powerChargeInterval);
        shootBall(power);
        power = 0;
        updatePowerBar();
    }

    // Topu vurma işlemi
    function shootBall(power) {
        const playerCenter = {
            x: playerPos.x + playerWidth / 2,
            y: playerPos.y + playerWidth / 2
        };
        const ballCenter = {
            x: ballPos.x + ballWidth / 2,
            y: ballPos.y + ballWidth / 2
        };

        const distance = Math.sqrt(
            Math.pow(playerCenter.x - ballCenter.x, 2) +
            Math.pow(playerCenter.y - ballCenter.y, 2)
        );
        
        const effectiveRange = playerWidth / 2 + ballWidth / 2 + 5; // Oyuncu ve top yarıçapları + tolerans

        if (distance < effectiveRange) {
            const playerRatingAvg = currentMatchMode === '11v11' && first11.length > 0
                ? first11.reduce((a,b) => a + b.rating, 0) / first11.length
                : 80; // 1v1 veya takım yoksa varsayılan rating

            const shotStrength = (power / 100) * ballBaseSpeedFactor * (1 + (playerRatingAvg - 70) / 100 * 0.05); // Rating etkisi ayarlandı
            
            // Oyuncudan topa doğru yön
            const angle = Math.atan2(ballCenter.y - playerCenter.y, ballCenter.x - playerCenter.x);
            ballVelocity.x = Math.cos(angle) * shotStrength;
            ballVelocity.y = Math.sin(angle) * shotStrength;

            matchMsg.textContent = `Vuruş! Güç: ${power.toFixed(0)}%.`;

            // Topa vuruş animasyonu ekle
            ballEl.classList.add('shot-anim');
            setTimeout(() => {
                ballEl.classList.remove('shot-anim');
            }, 200); // Animasyon süresi (CSS ile aynı olmalı)

        } else {
            matchMsg.textContent = "Topa uzaksın!";
        }
    }

    // Basit bot hareketi (topa yaklaşma ve şut çekme)
    function botMove() {
        if(!matchActive) return;

        const botCenter = {
            x: botPos.x + playerWidth / 2,
            y: botPos.y + playerWidth / 2
        };
        const ballCenter = {
            x: ballPos.x + ballWidth / 2,
            y: ballPos.y + ballWidth / 2
        };

        const targetX = ballPos.x;
        const targetY = ballPos.y;

        const dx = targetX - botPos.x;
        const dy = targetY - botPos.y;
        const dist = Math.sqrt(dx*dx + dy*dy);

        // Botun topu takip etmesi
        if(dist > 5) {
            botPos.x += (dx/dist) * botSpeed;
            botPos.y += (dy/dist) * botSpeed;
        }

        // Botun kendi sahasında kalmasını sağla (sahanın sağ yarısı)
        botPos.x = Math.max(matchAreaWidth / 2, Math.min(matchAreaWidth - playerWidth, botPos.x));
        botPos.y = Math.min(Math.max(0, botPos.y), matchAreaHeight - playerWidth);

        // Botun topa vurma mekaniği (basit AI)
        const botToBallDist = Math.sqrt(
            Math.pow(botCenter.x - ballCenter.x, 2) +
            Math.pow(botCenter.y - ballCenter.y, 2)
        );

        const botShootRange = playerWidth / 2 + ballWidth / 2 + 10; // Biraz daha geniş menzil
        if (botToBallDist < botShootRange && ballVelocity.x === 0 && ballVelocity.y === 0) { // Top hareketsizse vur
            // Botun kaleye doğru vurması
            const goalX = 0; // Hedef sol kale
            const goalY = matchAreaHeight / 2; // Kalenin ortası

            const shotDx = goalX - ballCenter.x;
            const shotDy = goalY - ballCenter.y;
            const shotDist = Math.sqrt(shotDx * shotDx + shotDy * shotDy);
            
            const botShotPower = (Math.random() * 0.5 + 0.5) * ballBaseSpeedFactor; // Orta rastgele güç (0.5-1.0x baseSpeed)
            ballVelocity.x = (shotDx / shotDist) * botShotPower;
            ballVelocity.y = (shotDy / shotDist) * botShotPower;

            // Topa vuruş animasyonu (bot için de)
            ballEl.classList.add('shot-anim');
            setTimeout(() => {
                ballEl.classList.remove('shot-anim');
            }, 200);
        }
        updatePositions();
    }

    // Çarpışma kontrolü (Basit çembersel çarpışma)
    function checkCollision(obj1Pos, obj1Size, obj2Pos, obj2Size) {
        const obj1Center = { x: obj1Pos.x + obj1Size / 2, y: obj1Pos.y + obj1Size / 2 };
        const obj2Center = { x: obj2Pos.x + obj2Size / 2, y: obj2Pos.y + obj2Size / 2 };

        const dx = obj1Center.x - obj2Center.x;
        const dy = obj1Center.y - obj2Center.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < (obj1Size / 2 + obj2Size / 2);
    }

    // Top hareketi
    function moveBall() {
        if (!matchActive) return;

        ballPos.x += ballVelocity.x;
        ballPos.y += ballVelocity.y;

        // Topun sahadan çıkmasını engelle ve sekme efekti ver
        // X ekseni (sol/sağ kenarlar)
        if (ballPos.x <= 0) {
            ballPos.x = 0;
            ballVelocity.x *= -0.8; // Hafif enerji kaybı
        } else if (ballPos.x + ballWidth >= matchAreaWidth) {
            ballPos.x = matchAreaWidth - ballWidth;
            ballVelocity.x *= -0.8;
        }

        // Y ekseni (üst/alt kenarlar)
        if (ballPos.y <= 0) {
            ballPos.y = 0;
            ballVelocity.y *= -0.8;
        } else if (ballPos.y + ballWidth >= matchAreaHeight) {
            ballPos.y = matchAreaHeight - ballWidth;
            ballVelocity.y *= -0.8;
        }

        // Sürtünme ile yavaşlama
        ballVelocity.x *= 0.98;
        ballVelocity.y *= 0.98;

        // Hız çok düşerse durdur
        if (Math.abs(ballVelocity.x) < 0.1) ballVelocity.x = 0;
        if (Math.abs(ballVelocity.y) < 0.1) ballVelocity.y = 0;

        // Oyuncu ile top çarpışması
        if (checkCollision(playerPos, playerWidth, ballPos, ballWidth)) {
            // Basit bir itme kuvveti
            const angle = Math.atan2(ballPos.y - playerPos.y, ballPos.x - playerPos.x);
            ballVelocity.x = Math.cos(angle) * (ballBaseSpeedFactor * 0.7); // Oyuncudan aldığı ivme
            ballVelocity.y = Math.sin(angle) * (ballBaseSpeedFactor * 0.7);
        }

        // Bot ile top çarpışması
        if (checkCollision(botPos, playerWidth, ballPos, ballWidth)) {
            const angle = Math.atan2(ballPos.y - botPos.y, ballPos.x - botPos.x);
            ballVelocity.x = Math.cos(angle) * (ballBaseSpeedFactor * 0.6); // Botun ivmesi
            ballVelocity.y = Math.sin(angle) * (ballBaseSpeedFactor * 0.6);
        }

        updatePositions();
    }

    // Ana oyun döngüsü
    let gameLoopActive = false; // Döngünün sadece bir kez başlaması için
    function gameLoop() {
        if(!matchActive) {
             gameLoopActive = false;
             return;
        }
        
        // PC hareket
        let moveX = 0;
        let moveY = 0;

        // W A S D veya ok tuşları kontrolü
        if(keysPressed["w"] || keysPressed["arrowup"]) moveY -= playerSpeed;
        if(keysPressed["s"] || keysPressed["arrowdown"]) moveY += playerSpeed;
        if(keysPressed["a"] || keysPressed["arrowleft"]) moveX -= playerSpeed;
        if(keysPressed["d"] || keysPressed["arrowright"]) moveX += playerSpeed;

        // Oyuncu pozisyonu güncelle
        playerPos.x += moveX;
        playerPos.y += moveY;

        // Sınırlar
        playerPos.x = Math.min(Math.max(0, playerPos.x), matchAreaWidth - playerWidth);
        playerPos.y = Math.min(Math.max(0, playerPos.y), matchAreaHeight - playerWidth);
        
        // Oyuncunun kendi sahasında kalmasını sağla (sahanın sol yarısı)
        playerPos.x = Math.min(matchAreaWidth / 2 - playerWidth, Math.max(0, playerPos.x));

        botMove(); // Botu hareket ettir
        moveBall(); // Topu hareket ettir
        checkGoal(); // Gol var mı kontrol et

        requestAnimationFrame(gameLoop);
    }

    // Joystick hareketi
    let joystickActive = false;
    let joystickCenter = {x: 0, y: 0};
    let joystickPos = {x: 0, y: 0};

    joystickContainer.addEventListener("pointerdown", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        joystickActive = true;
        const rect = joystickContainer.getBoundingClientRect();
        joystickCenter = {x: rect.width / 2, y: rect.height / 2};
        moveJoystick(e);
    });
    window.addEventListener("pointerup", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        joystickActive = false;
        joystick.style.left = joystickCenter.x - joystick.clientWidth/2 + "px";
        joystick.style.top = joystickCenter.y - joystick.clientHeight/2 + "px";
        joystickPos = {x: 0, y: 0};
    });
    window.addEventListener("pointermove", (e) => {
        if(!joystickActive || !matchActive) return;
        e.preventDefault();
        moveJoystick(e);
    });

    function moveJoystick(e) {
        const rect = joystickContainer.getBoundingClientRect();
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;
        const maxDistance = joystickContainer.clientWidth/2;
        let dx = x - maxDistance;
        let dy = y - maxDistance;

        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist > maxDistance) {
            dx = dx * maxDistance / dist;
            dy = dy * maxDistance / dist;
        }

        joystick.style.left = (maxDistance + dx - joystick.clientWidth/2) + "px";
        joystick.style.top = (maxDistance + dy - joystick.clientHeight/2) + "px";
        joystickPos = {x: dx / maxDistance, y: dy / maxDistance};
    }

    // Joystickla oyuncu hareketi döngüsü
    function joystickLoop() {
        if(!matchActive) {
            return;
        }
        playerPos.x += joystickPos.x * playerSpeed;
        playerPos.y += joystickPos.y * playerSpeed;

        // Sınırlar
        playerPos.x = Math.min(Math.max(0, playerPos.x), matchAreaWidth - playerWidth);
        playerPos.y = Math.min(Math.max(0, playerPos.y), matchAreaHeight - playerWidth);
        
        // Oyuncunun kendi sahasında kalmasını sağla (sahanın sol yarısı)
        playerPos.x = Math.min(matchAreaWidth / 2 - playerWidth, Math.max(0, playerPos.x));

        requestAnimationFrame(joystickLoop);
    }

    // Mobil ise joystick ve vur butonunu göster, değilse gizle
    function updateControlsVisibility() {
        // pointerdown ile dokunmatik cihazları tespit etmeye çalış
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
        if(isTouchDevice) {
            joystickContainer.style.display = "block";
            kickBtn.style.display = "block";
        } else {
            joystickContainer.style.display = "none";
            kickBtn.style.display = "none";
        }
    }

    // Mobil için dokunmatik olaylar (touchstart/touchend)
    kickBtn.addEventListener("touchstart", (e) => {
        if (!matchActive) return;
        e.preventDefault(); // Varsayılan dokunma olaylarını engelle
        startPowerCharge();
    }, { passive: false }); // passive: false kaydırma gibi olayları engellemek için

    kickBtn.addEventListener("touchend", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        stopPowerCharge();
    }, { passive: false });

    // PC için mouse olayları (mousedown/mouseup)
    kickBtn.addEventListener("mousedown", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        startPowerCharge();
    });
    kickBtn.addEventListener("mouseup", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        stopPowerCharge();
    });


    // Tema değiştirme
    themeRadios.forEach(radio => {
        radio.addEventListener("change", () => {
            if(radio.checked) {
                if(radio.value === "dark") {
                    document.body.style.background = "#1a1a2e";
                    document.body.style.color = "#e0e0e0";
                    // Daha fazla stil değişikliği eklenebilir
                } else if(radio.value === "light") {
                    document.body.style.background = "#f0f2f5"; /* Açık gri */
                    document.body.style.color = "#333";
                    // Diğer elementlerin arka plan ve renklerini de güncelleyebiliriz
                } else { // Default (current "dark" look)
                    document.body.style.background = "#1a1a2e";
                    document.body.style.color = "#e0e0e0";
                }
            }
        });
    });

    // Başlangıç işlemleri
    function initializeGame() {
        updateCoin();
        updateControlsVisibility(); // Kontrolleri başlat
        updateRosterLists(); // Oyuncuları güncelleyince selectbox da güncellenecek
        showSection("roster"); // Başlangıçta kadro bölümünü göster

        // İlk defa çağrılacak oyun döngüleri
        startGameLoops();
    }
    
    function startGameLoops() {
        if (!gameLoopActive) { // Sadece bir kez başlat
            requestAnimationFrame(gameLoop);
            requestAnimationFrame(joystickLoop);
            gameLoopActive = true;
        }
    }

    initializeGame();

})();
</script>

</body>
</html>
