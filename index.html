<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>SoccerTR</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  /* Temel stil */
  body {
    margin:0; padding:0; font-family: 'Roboto', sans-serif;
    background: #1a1a2e; /* Koyu mor-mavi arka plan */
    color: #e0e0e0;
    display: flex; flex-direction: column; height: 100vh;
    overflow: hidden; /* Taşmayı engelle */
    overscroll-behavior: contain; /* Mobil kaydırmayı engelle */
  }
  header {
    background: #0f3460; /* Daha koyu mavi */
    padding: 15px;
    text-align: center; font-size: 2.2rem;
    font-weight: 700; /* Kalınlık artırıldı */
    color:#e94560; /* Canlı kırmızı vurgu */
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    letter-spacing: 1px;
    font-family: 'Press Start 2P', cursive; /* Retro oyun fontu */
    -webkit-user-select: none; /* Metin kopyalamayı engelle */
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  nav {
    display: flex; background: #16213e; /* Bir ton açık */
    justify-content: space-around;
    padding: 5px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  nav button {
    background: transparent; border:none; color:#e0e0e0; padding:12px 18px;
    cursor:pointer; font-weight: 700;
    font-size: 1.05rem;
    transition: background-color 0.3s, color 0.3s, transform 0.2s;
    border-radius: 5px;
  }
  nav button:hover {
    background: rgba(233,69,96,0.2);
    transform: translateY(-2px);
  }
  nav button.active {
    background: #e94560; color:#fff;
    box-shadow: 0 2px 8px rgba(233,69,96,0.5);
    transform: translateY(-2px);
  }
  main {
    flex:1; overflow-y:auto; padding: 20px;
    background: linear-gradient(135deg, #2c3e50, #0f3460); /* Mor-mavi degrade */
    position: relative;
    display: flex; /* Ortalamak için */
    flex-direction: column; /* İçeriği dikey sırala */
    align-items: center; /* Ortalamak için */
  }

  /* Bölümler gizli */
  section {
    display:none;
    padding: 20px;
    background: #16213e; /* Kutu arka planı */
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    width: 90%;
    max-width: 1000px;
    margin-top: 20px; /* main içinde yukarıdan boşluk */
  }
  section.active {
    display:block;
  }

  /* Coin */
  #coinDisplay {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem; font-weight: 700;
    margin-bottom: 20px;
    color:#ffd700; /* Altın rengi */
    text-shadow: 0 0 8px rgba(255,215,0,0.6);
    background: #0f3460;
    padding: 10px 15px;
    border-radius: 8px;
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }
  #coinDisplay img {
      width: 25px;
      height: 25px;
      margin-right: 8px;
  }

  /* Kadro bölümü */
  .roster-container {
    display: flex; gap: 20px; flex-wrap: wrap;
    justify-content: center;
  }
  .roster-box {
    background: #0f3460; /* Koyu mavi kutu */
    padding: 20px;
    flex: 1; min-width: 280px; max-width: 350px;
    border-radius: 12px;
    max-height: 500px; overflow-y: auto;
    border: 1px solid rgba(233,69,96,0.3);
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
  }
  .roster-box h3 {
    text-align: center; margin-bottom: 15px;
    color:#e94560;
    border-bottom: 2px solid rgba(233,69,96,0.6);
    padding-bottom: 10px;
    font-size: 1.3rem;
  }
  ul.player-list {
    list-style:none; padding:0; margin:0;
    min-height: 100px; /* Sürükle bırak alanı için */
    flex-grow: 1; /* Listeyi doldur */
  }
  ul.player-list li {
    background: #16213e; /* Daha açık oyuncu kartı */
    margin:8px 0; padding: 10px 15px;
    border-radius: 8px; /* cursor:grab; */ /* Sürükle-bırak kaldırıldı */
    display:flex; flex-direction: column; /* Dikey düzenleme */
    align-items: flex-start;
    gap: 5px;
    transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    position: relative; /* Çerçeve için */
    cursor: pointer; /* Bilgi göstermek için tıklanabilir */
  }
  ul.player-list li:hover {
    background: #2c3e50;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .player-card-content {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
  }
  .player-thumbnail {
      width: 50px; height: 50px;
      border-radius: 50%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      color: #333;
      overflow: hidden;
      flex-shrink: 0;
  }
  .player-thumbnail img {
      width: 100%; height: 100%; object-fit: cover;
  }
  .player-text-info {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
  }
  .player-name {
    font-size: 1.1rem;
    font-weight: bold;
    color: #fff;
  }
  .player-info {
    font-size: 0.9rem; color:#b0b0b0;
  }
  .player-actions {
      display: flex; gap: 5px;
      margin-top: 5px;
      width: 100%;
      justify-content: flex-end; /* Butonları sağa hizala */
  }
  button.small-btn {
    padding: 8px 15px; font-size: 0.9rem;
    cursor:pointer; border:none; background:#e94560;
    color:#fff; border-radius: 6px;
    transition: background-color 0.2s, transform 0.1s;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  button.small-btn:hover:not(:disabled) {
    background:#d13550;
    transform: translateY(-1px);
  }
  button.small-btn:disabled {
    background:#666; cursor: not-allowed;
    box-shadow: none;
  }

  #increaseRosterBtn {
    display: block;
    width: fit-content;
    margin: 15px auto;
    padding: 10px 20px;
    font-size: 1rem;
    background-color: #5cb85c; /* Yeşil ton */
    color: #fff;
  }
  #increaseRosterBtn:hover:not(:disabled) {
    background-color: #4cae4c;
  }

  /* Oyuncu bilgi paneli */
  #playerInfoPanel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #0f3460;
      border: 3px solid #e94560;
      border-radius: 15px;
      padding: 30px;
      z-index: 1001;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
      display: none; /* Başlangıçta gizli */
      flex-direction: column;
      align-items: center;
      gap: 15px;
      max-width: 400px;
      text-align: center;
  }
  #playerInfoPanel.active {
      display: flex;
  }
  #playerInfoPanel h3 {
      color: #ffd700;
      font-size: 1.8rem;
      margin-bottom: 10px;
      text-shadow: 0 0 8px rgba(255,215,0,0.5);
  }
  #playerInfoPanel img {
      width: 120px; height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #fff;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
  }
  #playerInfoPanel p {
      font-size: 1.1rem;
      color: #e0e0e0;
      margin: 5px 0;
  }
  #playerInfoPanel .close-btn {
      position: absolute;
      top: 10px; right: 10px;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 30px; height: 30px;
      font-size: 1.2rem;
      cursor: pointer;
      line-height: 1;
      text-align: center;
      transition: background-color 0.2s;
  }
  #playerInfoPanel .close-btn:hover {
      background: #d32f2f;
  }

  /* Oyuncu kartı çerçeveleri */
  .player-frame {
    position: absolute;
    top: -2px; left: -2px;
    right: -2px; bottom: -2px;
    border-radius: 10px;
    pointer-events: none;
    z-index: 1;
  }
  .frame-bronze { border: 2px solid #cd7f32; box-shadow: 0 0 8px rgba(205,127,50,0.6); }
  .frame-silver { border: 2px solid #c0c0c0; box-shadow: 0 0 8px rgba(192,192,192,0.6); }
  .frame-gold { border: 2px solid #ffd700; box-shadow: 0 0 8px rgba(255,215,0,0.8); }
  .frame-diamond { border: 2px solid #b9f2ff; box-shadow: 0 0 10px rgba(185,242,255,0.9), 0 0 20px rgba(185,242,255,0.5); }

  /* Paket açma animasyonu */
  #packAnim {
    position: fixed; /* Tam ekranı kaplasın */
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(15,52,96,0.98); /* Koyu mavi, neredeyse tam şeffaf */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 2.2rem;
    font-weight: bold;
    color: #ffd700; /* Altın rengi */
    box-shadow: 0 0 40px rgba(255,215,0,0.8);
    opacity: 0;
    pointer-events: none; /* Tıklamayı engelle */
    z-index: 1000;
    transition: opacity 0.5s ease-out;
  }
  #packAnim.active {
    opacity: 1;
    pointer-events: auto;
  }
  #packAnim .ball {
    width: 120px; height: 120px;
    border-radius: 50%;
    background: linear-gradient(45deg, #e94560, #ff8c00); /* Kırmızı-turuncu degrade */
    margin: 25px auto 20px;
    animation: dribble 1.5s infinite ease-in-out, pulse 1s infinite alternate;
    box-shadow: 0 0 20px rgba(233,69,96,0.7);
  }
  #packAnimText {
      margin-top: 20px;
      font-size: 1.8rem;
      text-shadow: 0 0 10px rgba(255,215,0,0.6);
  }
  #packPlayerImage {
      width: 150px;
      height: 150px;
      background: #eee;
      border-radius: 50%;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 5rem;
      color: #333;
      border: 5px solid #ffd700;
      box-shadow: 0 0 15px rgba(255,215,0,0.8);
      overflow: hidden; /* Resim sığması için */
  }
  #packPlayerImage img {
      width: 100%; height: 100%; object-fit: cover;
  }

  @keyframes dribble {
    0% { transform: translateY(0) scale(1);}
    50% { transform: translateY(-40px) scale(1.1);}
    100% { transform: translateY(0) scale(1);}
  }
  @keyframes pulse {
    from { box-shadow: 0 0 20px rgba(233,69,96,0.7); }
    to { box-shadow: 0 0 40px rgba(255,215,0,0.9); }
  }


  /* Genel Form ve Buton Stilleri */
  label {
      display: block;
      margin-bottom: 8px;
      font-size: 1.1rem;
      color: #b0b0b0;
  }
  select, input[type="text"], input[type="password"] {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #0f3460;
      background-color: #1a1a2e;
      color: #e0e0e0;
      font-size: 1rem;
  }
  button:not(.small-btn) {
      padding: 12px 25px;
      font-size: 1.1rem;
      background-color: #e94560;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  button:not(.small-btn):hover:not(:disabled) {
      background-color: #d13550;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
  }
  button:not(.small-btn):disabled {
      background-color: #666;
      cursor: not-allowed;
      box-shadow: none;
  }

  /* Maç alanı - Tam ekran ve yan döndürme için */
  #matchSection.fullscreen-active {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      margin: 0;
      padding: 0;
      z-index: 999;
      background: #1a1a2e; /* Arka planı koyu yap */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
  }
  #matchArea {
    background: #008000; /* Yeşil çim rengi */
    border: 5px solid #005000; /* Koyu yeşil sınır */
    border-radius: 15px;
    position: relative;
    width: 95%; /* Genişlik artırıldı */
    max-width: 1200px; /* Alan genişliği daha da artırıldı */
    height: 600px; /* Yükseklik artırıldı */
    margin: 0px auto; /* Ortala */
    overflow: hidden;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.6);
    background: linear-gradient(to bottom, #008000, #006400); /* Hafif degrade */
  }
  /* Orta çizgi */
  #matchArea::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    width: 4px;
    height: 100%;
    background-color: rgba(255,255,255,0.7);
    transform: translateX(-50%);
    border-radius: 2px;
  }
  /* Orta daire */
  #matchArea::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    width: 120px; height: 120px;
    border: 4px solid rgba(255,255,255,0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
  }
  .goal-area {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 80px; /* Kale alanı derinliği artırıldı */
    height: 200px; /* Kale yüksekliği artırıldı */
    border: 4px solid rgba(255,255,255,0.7);
    border-radius: 5px;
    box-sizing: border-box;
  }
  .goal-area-left {
      left: 0;
      border-left: none;
  }
  .goal-area-right {
      right: 0;
      border-right: none;
  }
  .goal-post { /* Kaleler */
      position: absolute;
      width: 25px; /* Direk kalınlığı artırıldı */
      height: 70px; /* Direk uzunluğu artırıldı */
      background-color: #fff;
      border-radius: 3px;
      z-index: 2;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
  }
  .goal-post.left-top { top: calc(50% - 100px); left: -25px; } /* Kale alanına göre ayarlandı */
  .goal-post.left-bottom { top: calc(50% + 30px); left: -25px; }
  .goal-post.right-top { top: calc(50% - 100px); right: -25px; }
  .goal-post.right-bottom { top: calc(50% + 30px); right: -25px; }

  #player, #bot {
    position: absolute;
    width: 45px; height: 45px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; color: white;
    user-select: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    transition: transform 0.1s ease-out; /* Hareket animasyonu */
    overflow: hidden; /* Karakter görseli için */
    background-color: transparent; /* Arka planı kaldır */
  }
  #player img, #bot img {
      width: 100%; height: 100%; object-fit: contain; /* Görselin tamamı sığsın */
  }
  #player {
    left: 100px; top: 200px;
    z-index: 10;
  }
  #bot {
    right: 100px; top: 200px;
    z-index: 10;
  }
  #ball {
    position: absolute;
    background: radial-gradient(circle at 30% 30%, #f0f0f0, #a0a0a0); /* Gri tonları, hafif parlama */
    width: 28px; height: 28px;
    top: calc(50% - 14px); left: calc(50% - 14px);
    border-radius: 50%;
    z-index: 8;
    border: 2px solid #333;
    transition: transform 0.1s ease-out; /* Vuruş animasyonu */
  }
  #ball.shot-anim { /* Vuruş animasyonu sınıfı */
      animation: shotEffect 0.2s forwards;
  }
  @keyframes shotEffect {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); } /* Daha belirgin büyüme */
      100% { transform: scale(1); }
  }


  /* Vuruş gücü barı */
  #powerBarContainer {
    position: absolute;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    width: 350px; height: 25px; /* Daha belirgin */
    background: #333;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid #555;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    display: none; /* Başlangıçta gizli, sadece Space/VUR basıldığında görünür */
  }
  #powerBar {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #4CAF50, #FFEB3B, #F44336); /* Yeşil-sarı-kırmızı */
    transition: width 0.05s linear; /* Daha hızlı geçiş */
  }

  /* Joystick container */
  #joystickContainer {
    position: absolute;
    bottom: 40px; left: 20px;
    width: 140px; height: 140px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    touch-action: none;
    user-select: none;
    display: none; /* Varsayılan olarak gizli, mobil için açılır */
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  #joystick {
    position: absolute;
    width: 70px; height: 70px;
    background: #e94560;
    border-radius: 50%;
    top: 35px; left: 35px;
    touch-action: none;
    user-select: none;
    box-shadow: 0 0 15px rgba(233,69,96,0.7);
  }
  /* Vur tuşu mobil */
  #kickBtn {
    position: absolute;
    bottom: 60px; right: 40px;
    width: 90px; height: 90px; /* Daha büyük */
    background: #5cb85c; /* Yeşil */
    border-radius: 50%;
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
    display: none; /* Varsayılan olarak gizli, mobil için açılır */
    user-select: none;
    border: none;
    box-shadow: 0 0 20px rgba(92,184,92,0.8);
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
  }
  #kickBtn:active {
      transform: scale(0.95);
      box-shadow: 0 0 10px rgba(92,184,92,0.8);
  }

  #matchInfo {
    text-align: center;
    margin-top: 15px;
    font-size: 1.3rem;
    font-weight: 700;
    color: #fff;
    background: rgba(15,52,96,0.8);
    padding: 10px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
  }
  #scoreDisplay {
    font-size: 1.8rem;
    color: #ffd700;
    margin-bottom: 8px;
    text-shadow: 0 0 5px rgba(255,215,0,0.7);
  }
  #timerDisplay {
    font-size: 1.4rem;
    color: #e0e0e0;
  }
  #matchMsg {
      font-size: 1.1rem;
      margin-top: 10px;
      color: #add8e6; /* Açık mavi */
  }

  #matchOptions {
    text-align: center;
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 20px;
  }
  #matchOptions button {
    padding: 15px 30px;
    font-size: 1.2rem;
    background-color: #e94560;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  #matchOptions button:hover {
    background-color: #d13550;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
  }

  #exitMatchBtn { /* Maçtan Çık tuşu */
    position: fixed;
    top: 20px; right: 20px;
    z-index: 1000;
    padding: 10px 20px;
    background-color: #f44336; /* Kırmızı */
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    display: none; /* Maç modunda görünür */
  }
  #exitMatchBtn:hover {
      background-color: #d32f2f;
      transform: translateY(-2px);
  }

  #restartMatchBtn {
    display: block;
    margin: 30px auto 0;
    padding: 15px 30px;
    font-size: 1.1rem;
    background-color: #5cb85c;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    display: none; /* Maç bittiğinde görünür */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  #restartMatchBtn:hover {
    background-color: #4cae4c;
    transform: translateY(-2px);
  }

  /* Paket Görselleri */
  .pack-image-container {
      width: 150px;
      height: 150px;
      margin: 20px auto;
      border: 3px solid #e94560;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(233,69,96,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #0f3460;
  }
  .pack-image-container img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Görselin tamamının görünmesini sağla */
  }
  .pack-image-container .placeholder-text {
      color: #ffd700;
      font-size: 1.2rem;
      text-align: center;
      padding: 10px;
  }

  /* Giriş Ekranı */
  #loginScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: linear-gradient(135deg, #1a1a2e, #0f3460);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    color: #e0e0e0;
    text-align: center;
  }
  #loginScreen h2 {
      font-size: 2.5rem;
      color: #e94560;
      margin-bottom: 30px;
      font-family: 'Press Start 2P', cursive;
      -webkit-user-select: none; /* Metin kopyalamayı engelle */
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
  }
  #loginForm {
      background: #16213e;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      width: 90%;
      max-width: 400px;
  }
  #loginForm input {
      width: calc(100% - 20px);
      margin-bottom: 20px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #0f3460;
      background-color: #2c3e50;
      color: #e0e0e0;
      font-size: 1.1rem;
  }
  #loginForm button {
      width: 100%;
      padding: 15px;
      margin-top: 10px;
  }
  #loginToggle {
      margin-top: 20px;
      font-size: 0.95rem;
  }
  #loginToggle button {
      background: none;
      border: none;
      color: #ffd700;
      text-decoration: underline;
      cursor: pointer;
      padding: 5px;
      font-size: 0.95rem;
  }

  /* Genel Tema Değişikliği (Ayarlar için) */
  body.theme-light {
    background: #f0f2f5;
    color: #333;
  }
  body.theme-light header {
    background: #0a2647;
    color: #e94560;
  }
  body.theme-light nav {
    background: #205295;
  }
  body.theme-light nav button {
    color: #f0f2f5;
  }
  body.theme-light nav button.active {
    background: #e94560;
    color: #fff;
  }
  body.theme-light main {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  }
  body.theme-light section {
    background: #ffffff;
  }
  body.theme-light #coinDisplay {
      background: #0a2647;
      color: #ffd700;
  }
  body.theme-light .roster-box {
    background: #e0f2f7;
  }
  body.theme-light ul.player-list li {
    background: #f5f5f5;
    color: #333;
  }
  body.theme-light ul.player-list li .player-name {
    color: #333;
  }
  body.theme-light ul.player-list li .player-info {
    color: #666;
  }
  body.theme-light select, body.theme-light input[type="text"], body.theme-light input[type="password"] {
      border: 1px solid #bbdefb;
      background-color: #e0f2f7;
      color: #333;
  }
  body.theme-light #playerInfoPanel {
      background: #e0f2f7;
      border: 3px solid #205295;
  }
  body.theme-light #playerInfoPanel h3 {
      color: #205295;
  }
  body.theme-light #playerInfoPanel p {
      color: #333;
  }

  /* Custom Alert Modal */
  .custom-alert-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .custom-alert-overlay.active {
      opacity: 1;
      visibility: visible;
  }
  .custom-alert-box {
      background: #16213e;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      text-align: center;
      max-width: 400px;
      width: 90%;
      color: #e0e0e0;
      border: 2px solid #e94560;
      transform: translateY(-20px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
  }
  .custom-alert-overlay.active .custom-alert-box {
      transform: translateY(0);
      opacity: 1;
  }
  .custom-alert-box h3 {
      margin-top: 0;
      color: #ffd700;
      font-size: 1.5rem;
  }
  .custom-alert-box p {
      margin-bottom: 20px;
      font-size: 1.1rem;
      line-height: 1.5;
  }
  .custom-alert-box button {
      background-color: #e94560;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s;
  }
  .custom-alert-box button:hover {
      background-color: #d13550;
  }


  /* Responsive */
  @media (max-width: 768px) {
    header { font-size: 1.8rem; padding: 10px; }
    nav button { font-size: 0.9rem; padding: 10px 8px; }
    main { padding: 10px; }
    section { padding: 15px; max-width: 95%; margin-top: 10px; }
    #coinDisplay { font-size: 1.2rem; padding: 8px; }
    .roster-box { min-width: unset; width: 100%; max-width: unset; }
    .roster-container { flex-direction: column; align-items: center; gap: 15px; }
    ul.player-list li { font-size: 0.9rem; padding: 8px 10px; }
    .player-actions { justify-content: space-around; } /* Butonları mobil için ortala */
    button.small-btn { padding: 6px 12px; font-size: 0.8rem; }
    #packAnim { font-size: 1.5rem; }
    #packAnim .ball { width: 80px; height: 80px; }
    #packAnimText { font-size: 1.2rem; }
    #packPlayerImage { width: 100px; height: 100px; font-size: 3rem; }
    select, input[type="text"], button:not(.small-btn) { font-size: 1rem; padding: 10px; }

    #matchArea {
      height: 350px;
      max-width: 95%;
      margin: 10px auto;
    }
    #player, #bot {
      width: 35px; height: 35px;
      font-size: 0.9rem;
    }
    #ball {
      width: 24px; height: 24px;
      top: calc(50% - 12px); left: calc(50% - 12px);
    }
    #joystickContainer, #kickBtn {
        display: block; /* Mobil cihazlarda görünür */
    }
    #joystickContainer {
      width: 120px; height: 120px;
      bottom: 20px; left: 10px;
    }
    #joystick {
      width: 60px; height: 60px;
      top: 30px; left: 30px;
    }
    #kickBtn {
      width: 80px; height: 80px;
      font-size: 1.5rem;
      bottom: 30px; right: 20px;
    }
    #powerBarContainer {
      width: 250px; height: 20px;
      bottom: 10px;
    }
    #matchInfo {
      font-size: 1.1rem;
      padding: 8px 15px;
      margin-top: 10px;
    }
    #scoreDisplay { font-size: 1.5rem; }
    #timerDisplay { font-size: 1.2rem; }
    #matchMsg { font-size: 1rem; }
    #matchOptions button { padding: 12px 25px; font-size: 1.1rem; }
    #restartMatchBtn { padding: 12px 25px; font-size: 1rem; margin-top: 20px; }
    #exitMatchBtn { top: 10px; right: 10px; padding: 8px 15px; font-size: 0.9rem; }

    .goal-area { width: 40px; height: 120px; } /* Mobil için kale boyutu */
    .goal-post { width: 15px; height: 45px; }
    .goal-post.left-top { top: calc(50% - 60px); left: -15px; }
    .goal-post.left-bottom { top: calc(50% + 15px); left: -15px; }
    .goal-post.right-top { top: calc(50% - 60px); right: -15px; }
    .goal-post.right-bottom { top: calc(50% + 15px); right: -15px; }

    /* Mobil yatay mod (Landscape) */
    @media screen and (orientation: landscape) and (max-width: 900px) {
        /* Maç bölümü dışındaki tüm ana içerikleri gizle */
        main > section:not(#matchSection) {
            display: none !important;
        }
        main {
            padding: 0; /* İç boşluğu kaldır */
            justify-content: center;
            align-items: center;
        }
        #coinDisplay, header, nav {
            display: none !important; /* Menü ve başlıkları gizle */
        }
        #matchSection.fullscreen-active {
            width: 100vw; height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column; /* Tekrar dikey sıralama */
        }
        #matchInfo {
            margin-top: 5px; /* Üstten boşluğu azalt */
            font-size: 1rem;
            padding: 5px 10px;
        }
        #scoreDisplay { font-size: 1.2rem; margin-bottom: 2px; }
        #timerDisplay { font-size: 1rem; }
        #matchMsg { font-size: 0.9rem; margin-top: 2px; }
        #matchOptions button { padding: 12px 25px; font-size: 1.1rem; }
        #restartMatchBtn {
            margin: 10px auto 0;
            padding: 10px 20px;
            font-size: 0.9rem;
        }
        /* Maç alanını dikeyde ortala */
        #matchSection.fullscreen-active > *:not(#matchArea) {
            position: relative; /* Sabit pozisyonu kaldır */
            transform: none; /* Transformu sıfırla */
        }
    }
  }
</style>
</head>
<body>

<div id="loginScreen">
    <div id="loginForm">
        <h2>SoccerTR</h2>
        <input type="text" id="usernameInput" placeholder="Kullanıcı Adı" />
        <input type="password" id="passwordInput" placeholder="Şifre" />
        <button id="loginButton">Giriş Yap</button>
        <div id="loginToggle">
            Hesabın yok mu? <button id="registerPrompt">Kaydol</button>
        </div>
    </div>
</div>

<header>SoccerTR</header>
<nav style="display:none;">
    <button id="btnRoster" class="active">Kadro</button>
    <button id="btnPack">Paket Aç</button>
    <button id="btnTraining">Antrenman</button>
    <button id="btnMatch">Maç</button>
    <button id="btnSettings">Ayarlar</button>
</nav>

<main style="display:none;">
    <div id="coinDisplay">
        <img src="https://www.flaticon.com/svg/v2/icons/svg/883/883710.svg" alt="Coin" />
        <span id="coinCount">100</span>
    </div>

    <section id="rosterSection" class="active">
        <button id="increaseRosterBtn" class="small-btn">Kadro Dışını +100 (100 Coin)</button>
        <div class="roster-container">
            <div class="roster-box">
                <h3>İlk 11 (<span id="first11Count">0</span>/11)</h3>
                <ul id="first11" class="player-list" data-list="first11"></ul>
            </div>
            <div class="roster-box">
                <h3>Yedek (<span id="substitutesCount">0</span>/11)</h3>
                <ul id="substitutes" class="player-list" data-list="substitutes"></ul>
            </div>
            <div class="roster-box">
                <h3>Kadro Dışı (<span id="rosterOutCount">0</span>/<span id="rosterLimitCount">500</span>)</h3>
                <ul id="rosterOut" class="player-list" data-list="rosterOut"></ul>
            </div>
        </div>
    </section>

    <section id="packSection">
        <h2>Paket Aç</h2>
        <p>100 Coin karşılığında rastgele bir ligden oyuncu kazan!</p>
        <label for="leagueSelect">Lig Seç:</label>
        <select id="leagueSelect">
            <option value="">Lig seçiniz...</option>
            <option value="mls">MLS</option>
            <option value="premier">Premier Lig</option>
            <option value="bundesliga">Bundesliga</option>
            <option value="laliga">La Liga</option>
            <option value="ligue1">Ligue 1</option>
            <option value="seriea">Serie A</option>
            <option value="superlig">Süper Lig</option>
            <option value="saudiprolig">Suudi Pro Lig</option>
        </select>
        <div id="packImageContainer" class="pack-image-container">
            <span class="placeholder-text">Paket Resmi</span>
        </div>
        <button id="openPackBtn" disabled>Paket Aç (100 Coin)</button>
        <div id="packAnim">
            <div class="ball"></div>
            <div id="packAnimText">Paket Açılıyor...</div>
            <div id="packPlayerImage"></div>
        </div>
    </section>

    <section id="trainingSection">
        <h2>Antrenman</h2>
        <p>Oyuncularınızı geliştirerek ratinglerini artırın.</p>
        <label for="trainSelect">Oyuncu Seç:</label>
        <select id="trainSelect">
            <option value="">Oyuncu seçiniz...</option>
        </select>
        <div style="margin-top: 15px; display: flex; gap: 15px; justify-content: center;">
            <button id="normalTrainBtn" disabled>Normal Antrenman (Ücretsiz)</button>
            <button id="playerTrainBtn" disabled>Özel Antrenman (Ücretsiz)</button>
        </div>
        <div id="trainMsg" style="margin-top:20px; font-weight:bold; text-align: center; font-size: 1.1rem;"></div>
    </section>

    <section id="matchSection">
        <h2>Maç</h2>
        <div id="matchOptions">
            <button id="start1v1MatchBtn">1 vs 1 Maç Başlat</button>
            <button id="start11v11MatchBtn">11 vs 11 Maç Başlat</button>
        </div>

        <div id="matchInfo" style="display:none;">
            <div id="scoreDisplay">Senin Takımın 0 - 0 Bot Takımı</div>
            <div id="timerDisplay">Süre: 02:00</div>
            <div id="matchMsg" style="margin-top:5px;"></div>
        </div>

        <div id="matchArea" style="display:none;">
            <div class="goal-area goal-area-left">
                <div class="goal-post left-top"></div>
                <div class="goal-post left-bottom"></div>
            </div>
            <div class="goal-area goal-area-right">
                <div class="goal-post right-top"></div>
                <div class="goal-post right-bottom"></div>
            </div>
            <div id="player"></div>
            <div id="bot"></div>
            <div id="ball"></div>
            <div id="joystickContainer">
                <div id="joystick"></div>
            </div>
            <button id="kickBtn">VUR</button>
            <div id="powerBarContainer">
                <div id="powerBar"></div>
            </div>
        </div>
        <button id="restartMatchBtn">Maçı Yeniden Başlat</button>
    </section>

    <section id="settingsSection">
        <h2>Ayarlar</h2>
        <label for="languageSelect">Dil Seçimi:</label>
        <select id="languageSelect">
            <option value="tr">Türkçe</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
            <option value="ru">Русский</option>
            <option value="pt">Português</option>
        </select>
        <br/><br/>
        <label>Tema:</label><br/>
        <input type="radio" id="themeDefault" name="theme" value="default" checked><label for="themeDefault">Varsayılan</label><br/>
        <input type="radio" id="themeDark" name="theme" value="dark"><label for="themeDark">Koyu</label><br/>
        <input type="radio" id="themeLight" name="theme" value="light"><label for="themeLight">Açık</label>
        <br/><br/>
        <button id="logoutButton">Hesaptan Çıkış Yap</button>
        <button id="deleteAccountButton" style="background-color: #f44336;">Hesabı Sil</button>
    </section>
</main>
<button id="exitMatchBtn">Maçtan Çık</button>

<div id="playerInfoPanel">
    <button class="close-btn" onclick="document.getElementById('playerInfoPanel').classList.remove('active');">&times;</button>
    <h3>Oyuncu Bilgisi</h3>
    <div id="infoPlayerImage"></div>
    <p>Ad: <span id="infoPlayerName"></span></p>
    <p>Rating: <span id="infoPlayerRating"></span></p>
    <p>Gol: <span id="infoPlayerGoals"></span></p>
    <p>Asist: <span id="infoPlayerAssists"></span></p>
</div>

<div id="customAlertOverlay" class="custom-alert-overlay">
    <div class="custom-alert-box">
        <h3 id="customAlertTitle"></h3>
        <p id="customAlertMessage"></p>
        <button id="customAlertOkBtn">Tamam</button>
    </div>
</div>

<script>
(() => {
    // --- Statik Veriler ve Sabitler ---
    const ligPaketleri = {
        mls: {
            players: ["Lionel Messi", "Luis Suárez", "Jordi Alba", "Sergio Busquets", "Cucho Hernández", "Héctor Herrera", "Lorenzo Insigne", "Denis Bouanga", "Thiago Almada", "Lucho Acosta"],
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Major_League_Soccer_logo_2023.svg/1024px-Major_League_Soccer_logo_2023.svg.png"
        },
        premier: {
            players: ["Erling Haaland", "Phil Foden", "Bukayo Saka", "Cole Palmer", "Ollie Watkins", "Declan Rice", "Rodri", "Virgil van Dijk", "Alisson Becker", "Martin Ødegaard"],
            image: "https://upload.wikimedia.org/wikipedia/en/thumb/f/f2/Premier_League_Logo.svg/800px-Premier_League_Logo.svg.png"
        },
        bundesliga: {
            players: ["Harry Kane", "Jamal Musiala", "Florian Wirtz", "Leroy Sané", "Joshua Kimmich", "Manuel Neuer", "Patrik Schick", "Serhou Guirassy", "Niclas Füllkrug", "Xavi Simons"],
            image: "https://upload.wikimedia.org/wikipedia/en/thumb/d/df/Bundesliga_logo_%282017%29.svg/800px-Bundesliga_logo_%282017%29.svg.png"
        },
        laliga: {
            players: ["Vinicius Jr", "Jude Bellingham", "Robert Lewandowski", "Antoine Griezmann", "Marc-André ter Stegen", "Federico Valverde", "Ronald Araújo", "Pedri", "Gavi", "Eder Militão"],
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/LaLiga_logo_%282023%29.svg/800px-LaLiga_logo_%282023%29.svg.png"
        },
        ligue1: {
            players: ["Kylian Mbappé", "Achraf Hakimi", "Gianluigi Donnarumma", "Marquinhos", "Ousmane Dembélé", "Warren Zaïre-Emery", "Jonathan David", "Alexandre Lacazette", "Pierre-Emerick Aubameyang", "Elye Wahi"],
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Ligue_1_Uber_Eats_logo.svg/800px-Ligue_1_Uber_Eats_logo.svg.png"
        },
        seriea: {
            players: ["Victor Osimhen", "Khvicha Kvaratskhelia", "Lautaro Martínez", "Rafael Leão", "Nicolò Barella", "Federico Dimarco", "Theo Hernández", "Mike Maignan", "Paulo Dybala", "Dusan Vlahović"],
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Serie_A_logo_%28with_sponsor%29.svg/800px-Serie_A_logo_%28with_sponsor%29.svg.png"
        },
        superlig: {
            players: ["Mauro Icardi", "Dries Mertens", "Edin Džeko", "Dušan Tadić", "Fred", "Lucas Torreira", "Kerem Aktürkoğlu", "Uğurcan Çakır", "Semih Kılıçsoy", "Sebastian Szymanski"],
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/S%C3%BCper_Lig_Logo.svg/800px-S%C3%BCper_Lig_Logo.svg.png"
        },
        saudiprolig: {
            players: ["Cristiano Ronaldo", "Karim Benzema", "Neymar Jr", "Sadio Mané", "Riyad Mahrez", "Marcelo Brozović", "Sergej Milinković-Savić", "Fabinho", "Kalidou Koulibaly", "Ruben Neves"],
            image: "https://upload.wikimedia.org/wikipedia/en/thumb/0/07/Saudi_Pro_League_logo.svg/800px-Saudi_Pro_League_logo.svg.png"
        }
    };

    const defaultPlayerImage = "https://via.placeholder.com/150/16213E/E0E0E0?text=Oyuncu"; // Placeholder image URL
    // Ronaldo ve Messi için basit temsili ikonlar
    const ronaldoImage = "https://img.icons8.com/color/48/cristiano-ronaldo.png"; // Placeholder
    const messiImage = "https://img.icons8.com/color/48/lionel-messi.png"; // Placeholder
    const genericPlayerImage = "https://img.icons8.com/ios-filled/50/football2.png"; // Generic player icon
    // Oyuncu ve Bot için basit insan figürü (yerel SVG veya daha iyi bir icon)
    const playerFigureImage = "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Football_Player_Silhouette.svg/100px-Football_Player_Silhouette.svg.png"; // Basit insan figürü
    const botFigureImage = "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Robot_icon.svg/100px-Robot_icon.svg.png"; // Basit bot figürü


    // --- Oyun Verileri (Hesaba Özel) ---
    let currentUser = null;
    let coin = 100;
    let rosterLimit = 500;
    let players = []; // Tüm oyuncular
    let first11 = [];
    let substitutes = [];
    let rosterOut = [];
    let nextId = 1; // Oyuncular için otomatik ID

    // --- DOM Elementleri ---
    const loginScreen = document.getElementById("loginScreen");
    const usernameInput = document.getElementById("usernameInput");
    const passwordInput = document.getElementById("passwordInput");
    const loginButton = document.getElementById("loginButton");
    const registerPrompt = document.getElementById("registerPrompt");
    const navBar = document.querySelector("nav");
    const mainContent = document.querySelector("main");

    const coinDisplay = document.getElementById("coinDisplay");
    const coinCountEl = document.getElementById("coinCount");
    const btnRoster = document.getElementById("btnRoster");
    const btnPack = document.getElementById("btnPack");
    const btnTraining = document.getElementById("btnTraining");
    const btnMatch = document.getElementById("btnMatch");
    const btnSettings = document.getElementById("btnSettings");

    const rosterSection = document.getElementById("rosterSection");
    const packSection = document.getElementById("packSection");
    const trainingSection = document.getElementById("trainingSection");
    const matchSection = document.getElementById("matchSection");
    const settingsSection = document.getElementById("settingsSection");

    const first11List = document.getElementById("first11");
    const first11CountEl = document.getElementById("first11Count");
    const subsList = document.getElementById("substitutes");
    const substitutesCountEl = document.getElementById("substitutesCount");
    const rosterOutList = document.getElementById("rosterOut");
    const rosterOutCountEl = document.getElementById("rosterOutCount");
    const rosterLimitCountEl = document.getElementById("rosterLimitCount");
    const increaseRosterBtn = document.getElementById("increaseRosterBtn");

    const playerInfoPanel = document.getElementById("playerInfoPanel");
    const infoPlayerImage = document.getElementById("infoPlayerImage");
    const infoPlayerName = document.getElementById("infoPlayerName");
    const infoPlayerRating = document.getElementById("infoPlayerRating");
    const infoPlayerGoals = document.getElementById("infoPlayerGoals");
    const infoPlayerAssists = document.getElementById("infoPlayerAssists");

    const leagueSelect = document.getElementById("leagueSelect");
    const packImageContainer = document.getElementById("packImageContainer");
    const openPackBtn = document.getElementById("openPackBtn");
    const packAnim = document.getElementById("packAnim");
    const packAnimText = document.getElementById("packAnimText");
    const packPlayerImage = document.getElementById("packPlayerImage");

    const trainSelect = document.getElementById("trainSelect");
    const normalTrainBtn = document.getElementById("normalTrainBtn");
    const playerTrainBtn = document.getElementById("playerTrainBtn");
    const trainMsg = document.getElementById("trainMsg");

    const matchOptions = document.getElementById("matchOptions");
    const start1v1MatchBtn = document.getElementById("start1v1MatchBtn");
    const start11v11MatchBtn = document.getElementById("start11v11MatchBtn");
    const matchInfo = document.getElementById("matchInfo");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const timerDisplay = document.getElementById("timerDisplay");
    const matchArea = document.getElementById("matchArea");
    const playerEl = document.getElementById("player");
    const botEl = document.getElementById("bot");
    const ballEl = document.getElementById("ball");
    const joystickContainer = document.getElementById("joystickContainer");
    const joystick = document.getElementById("joystick");
    const kickBtn = document.getElementById("kickBtn");
    const powerBarContainer = document.getElementById("powerBarContainer");
    const powerBar = document.getElementById("powerBar");
    const matchMsg = document.getElementById("matchMsg");
    const restartMatchBtn = document.getElementById("restartMatchBtn");
    const exitMatchBtn = document.getElementById("exitMatchBtn");

    const languageSelect = document.getElementById("languageSelect");
    const themeRadios = document.querySelectorAll('input[name="theme"]');
    const logoutButton = document.getElementById("logoutButton");
    const deleteAccountButton = document.getElementById("deleteAccountButton");

    // Custom Alert DOM Elements
    const customAlertOverlay = document.getElementById("customAlertOverlay");
    const customAlertTitle = document.getElementById("customAlertTitle");
    const customAlertMessage = document.getElementById("customAlertMessage");
    const customAlertOkBtn = document.getElementById("customAlertOkBtn");


    // --- Uluslararasılaştırma (i18n) ---
    const translations = {
        tr: {
            roster: "Kadro",
            pack: "Paket Aç",
            training: "Antrenman",
            match: "Maç",
            settings: "Ayarlar",
            coin: "Coin",
            first11: "İlk 11",
            substitutes: "Yedek",
            rosterOut: "Kadro Dışı",
            increaseRoster: "Kadro Dışını +100 (100 Coin)",
            openPack: "Paket Aç (100 Coin)",
            playerInfo: "Oyuncu Bilgisi",
            rating: "Rating",
            goals: "Gol",
            assists: "Asist",
            packOpening: "Paket Açılıyor...",
            congrats: "Tebrikler! {playerName} kazandınız!",
            selectPlayer: "Oyuncu seçiniz...",
            selectLeague: "Lig seçiniz...", // Eklendi
            normalTraining: "Normal Antrenman (Ücretsiz)",
            specialTraining: "Özel Antrenman (Ücretsiz)",
            trainMsgMaxRating: "{playerName} zaten en yüksek rating'de!",
            trainMsgNormal: "{playerName} normal antrenmanla +{inc} rating kazandı! Şimdi: {rating}",
            trainMsgSpecial: "{playerName} özel antrenmanla +{inc} rating aldı! Şimdi: {rating}",
            goalScored: "⚽ Gol attı!",
            assistMade: "🅰️ Asist yaptı!",
            start1v1: "1 vs 1 Maç Başlat",
            start11v11: "11 vs 11 Maç Başlat",
            yourTeam: "Senin Takımın",
            botTeam: "Bot Takımı",
            time: "Süre",
            matchStarted: "Maç başladı!",
            matchContinue: "Maça devam!",
            goal: "GOOOL! 🎉",
            goalConceded: "GOL YEDİN! 😩",
            shot: "Vuruş! Güç: {power}%.",
            tooFar: "Topa uzaksın! Vuruş yapılamadı.",
            matchWin: "Maçı KAZANDIN! 🎉",
            matchLose: "Maçı KAYBETTİN! 😩",
            matchDraw: "Maç BERABERE! 🤝",
            restartMatch: "Maçı Yeniden Başlat",
            exitMatch: "Maçtan Çık",
            languageSelect: "Dil Seçimi:",
            theme: "Tema:",
            default: "Varsayılan",
            dark: "Koyu",
            light: "Açık",
            logout: "Hesaptan Çıkış Yap",
            deleteAccount: "Hesabı Sil",
            loginTitle: "Giriş Yap",
            username: "Kullanıcı Adı",
            password: "Şifre",
            loginButton: "Giriş Yap",
            noAccount: "Hesabın yok mu?",
            register: "Kaydol",
            registerTitle: "Kaydol",
            registerButton: "Kaydol",
            alreadyAccount: "Zaten hesabın var mı?",
            loginPrompt: "Giriş Yap",
            fillAllFields: "Lütfen tüm alanları doldurun.",
            userExists: "Bu kullanıcı adı zaten mevcut.",
            registrationSuccess: "Kayıt başarılı! Giriş yapabilirsiniz.",
            invalidCredentials: "Yanlış kullanıcı adı veya şifre.",
            loggedIn: "Başarıyla giriş yapıldı!",
            accountDeletedConfirm: "Hesabınızı silmek istediğinize emin misiniz? Bu işlem geri alınamaz.",
            accountDeleted: "Hesabınız başarıyla silindi.",
            notEnoughCoin: "Yeterli coin yok!",
            rosterFull: "Kadro dışı limiti dolu. Lütfen kadro dışını arttırın (Kadro bölümünde).",
            allPlayersInLeague: "Bu ligde tüm oyuncular sizde var veya oyuncu havuzu boş! Farklı bir lig deneyin.",
            first11Full: "İlk 11 dolu! Lütfen önce bir oyuncuyu kadro dışı bırakın.",
            substitutesFull: "Yedekler dolu! Lütfen önce bir oyuncuyu kadro dışı bırakın.",
            rosterLimitFull: "Kadro dışı limiti dolu! Limiti artırın veya bir oyuncu silin.",
            rosterIncreaseSuccess: "Kadro dışı limiti +100 oldu: {limit}",
            first11Required: "11 vs 11 maç için İlk 11'de 11 oyuncun olmalı!",
            passwordRequirements: "Şifre 8-16 karakter, en az bir özel karakter, bir rakam, bir büyük harf ve bir küçük harf içermelidir.",
            matchExitConfirm: "Maçtan çıkmak istediğinize emin misiniz? Maç kaybolacak!",
            restartMatchPrompt: "Tekrar denemek için 'Maçı Yeniden Başlat'a tıkla."
        },
        en: {
            roster: "Roster",
            pack: "Open Pack",
            training: "Training",
            match: "Match",
            settings: "Settings",
            coin: "Coin",
            first11: "First 11",
            substitutes: "Substitutes",
            rosterOut: "Roster Out",
            increaseRoster: "Increase Roster by +100 (100 Coin)",
            openPack: "Open Pack (100 Coin)",
            playerInfo: "Player Info",
            rating: "Rating",
            goals: "Goals",
            assists: "Assists",
            packOpening: "Opening Pack...",
            congrats: "Congratulations! You got {playerName}!",
            selectPlayer: "Select player...",
            selectLeague: "Select league...", // Eklendi
            normalTraining: "Normal Training (Free)",
            specialTraining: "Special Training (Free)",
            trainMsgMaxRating: "{playerName} is already at max rating!",
            trainMsgNormal: "{playerName} gained +{inc} rating with normal training! Now: {rating}",
            trainMsgSpecial: "{playerName} gained +{inc} rating with special training! Now: {rating}",
            goalScored: "⚽ Goal!",
            assistMade: "🅰️ Assist!",
            start1v1: "Start 1 vs 1 Match",
            start11v11: "Start 11 vs 11 Match",
            yourTeam: "Your Team",
            botTeam: "Bot Team",
            time: "Time",
            matchStarted: "Match started!",
            matchContinue: "Continue match!",
            goal: "GOAL! 🎉",
            goalConceded: "GOAL CONCEDED! 😩",
            shot: "Shot! Power: {power}%.",
            tooFar: "Too far from the ball! Cannot shoot.",
            matchWin: "You WON the match! 🎉",
            matchLose: "You LOST the match! 😩",
            matchDraw: "The match is a DRAW! 🤝",
            restartMatch: "Restart Match",
            exitMatch: "Exit Match",
            languageSelect: "Language Selection:",
            theme: "Theme:",
            default: "Default",
            dark: "Dark",
            light: "Light",
            logout: "Logout",
            deleteAccount: "Delete Account",
            loginTitle: "Login",
            username: "Username",
            password: "Password",
            loginButton: "Login",
            noAccount: "Don't have an account?",
            register: "Register",
            registerTitle: "Register",
            registerButton: "Register",
            alreadyAccount: "Already have an account?",
            loginPrompt: "Login",
            fillAllFields: "Please fill in all fields.",
            userExists: "This username already exists.",
            registrationSuccess: "Registration successful! You can now log in.",
            invalidCredentials: "Invalid username or password.",
            loggedIn: "Successfully logged in!",
            accountDeletedConfirm: "Are you sure you want to delete your account? This action cannot be undone.",
            accountDeleted: "Your account has been successfully deleted.",
            notEnoughCoin: "Not enough coin!",
            rosterFull: "Roster out limit is full. Please increase roster out capacity (in Roster section).",
            allPlayersInLeague: "You have all players in this league or the player pool is empty! Try a different league.",
            first11Full: "First 11 is full! Please move a player to roster out first.",
            substitutesFull: "Substitutes are full! Please move a player to roster out first.",
            rosterLimitFull: "Roster out limit is full! Increase the limit or delete a player.",
            rosterIncreaseSuccess: "Roster out limit increased by +100: {limit}",
            first11Required: "For an 11 vs 11 match, you need 11 players in your First 11!",
            passwordRequirements: "Password must be 8-16 characters, contain at least one special character, one digit, one uppercase letter, and one lowercase letter.",
            matchExitConfirm: "Are you sure you want to exit the match? The match will be lost!",
            restartMatchPrompt: "Click 'Restart Match' to try again."
        }
        // Diğer diller buraya eklenebilir
    };

    let currentLanguage = "tr";

    // --- Custom Alert Fonksiyonu ---
    function customAlert(title, message, callback) {
        customAlertTitle.textContent = title;
        customAlertMessage.textContent = message;
        customAlertOverlay.classList.add("active");

        const handleOkClick = () => {
            customAlertOverlay.classList.remove("active");
            customAlertOkBtn.removeEventListener("click", handleOkClick);
            if (callback) callback();
        };

        customAlertOkBtn.addEventListener("click", handleOkClick);
    }


    function updateTextContent() {
        const t = translations[currentLanguage];
        document.getElementById("btnRoster").textContent = t.roster;
        document.getElementById("btnPack").textContent = t.pack;
        document.getElementById("btnTraining").textContent = t.training;
        document.getElementById("btnMatch").textContent = t.match;
        document.getElementById("btnSettings").textContent = t.settings;
        document.getElementById("increaseRosterBtn").textContent = t.increaseRoster;
        document.querySelector("#rosterSection .roster-box:nth-of-type(1) h3").innerHTML = `${t.first11} (<span id="first11Count">${first11.length}</span>/11)`;
        document.querySelector("#rosterSection .roster-box:nth-of-type(2) h3").innerHTML = `${t.substitutes} (<span id="substitutesCount">${substitutes.length}</span>/11)`;
        document.querySelector("#rosterSection .roster-box:nth-of-type(3) h3").innerHTML = `${t.rosterOut} (<span id="rosterOutCount">${rosterOut.length}</span>/<span id="rosterLimitCount">${rosterLimit}</span>)`;
        document.querySelector("#packSection h2").textContent = t.pack;
        document.querySelector("#packSection p").textContent = `100 ${t.coin} karşılığında rastgele bir ligden oyuncu kazan!`; // Sabit tuttum
        document.querySelector("label[for='leagueSelect']").textContent = t.selectLeague.replace(':', '');
        leagueSelect.options[0].textContent = t.selectLeague; // "Lig seçiniz..."
        openPackBtn.textContent = t.openPack;
        packAnimText.textContent = t.packOpening; // Başlangıç metni

        document.querySelector("#trainingSection h2").textContent = t.training;
        document.querySelector("label[for='trainSelect']").textContent = t.selectPlayer.replace(':', '');
        trainSelect.options[0].textContent = t.selectPlayer;
        normalTrainBtn.textContent = t.normalTraining;
        playerTrainBtn.textContent = t.specialTraining;

        document.querySelector("#matchSection h2").textContent = t.match;
        start1v1MatchBtn.textContent = t.start1v1;
        start11v11MatchBtn.textContent = t.start11v11;
        document.querySelector("#matchInfo #scoreDisplay").textContent = `${t.yourTeam} ${playerScore} - ${botScore} ${t.botTeam}`;
        document.querySelector("#matchInfo #timerDisplay").textContent = `${t.time}: ${Math.floor(matchTime/60).toString().padStart(2, '0')}:${(matchTime%60).toString().padStart(2, '0')}`;
        restartMatchBtn.textContent = t.restartMatch;
        exitMatchBtn.textContent = t.exitMatch;

        document.querySelector("#settingsSection h2").textContent = t.settings;
        document.querySelector("label[for='languageSelect']").textContent = t.languageSelect;
        document.querySelector("label[for='themeDefault']").textContent = t.default;
        document.querySelector("label[for='themeDark']").textContent = t.dark;
        document.querySelector("label[for='themeLight']").textContent = t.light;
        logoutButton.textContent = t.logout;
        deleteAccountButton.textContent = t.deleteAccount;

        // Login ekranı metinleri
        document.querySelector("#loginScreen h2").textContent = "SoccerTR"; // Logo gibi
        usernameInput.placeholder = t.username;
        passwordInput.placeholder = t.password;
        loginButton.textContent = isRegisterMode ? t.registerButton : t.loginButton;
        registerPrompt.textContent = isRegisterMode ? t.loginPrompt : t.register;
        document.getElementById("loginToggle").childNodes[0].nodeValue = isRegisterMode ? t.alreadyAccount : t.noAccount;
        
        document.getElementById("playerInfoPanel h3").textContent = t.playerInfo;
        document.querySelector("#playerInfoPanel p:nth-of-type(1)").childNodes[0].nodeValue = `${t.name}: `;
        document.querySelector("#playerInfoPanel p:nth-of-type(2)").childNodes[0].nodeValue = `${t.rating}: `;
        document.querySelector("#playerInfoPanel p:nth-of-type(3)").childNodes[0].nodeValue = `${t.goals}: `;
        document.querySelector("#playerInfoPanel p:nth-of-type(4)").childNodes[0].nodeValue = `${t.assists}: `;
    }

    // --- Hesap Yönetimi Fonksiyonları ---
    let users = JSON.parse(localStorage.getItem('soccer_users')) || {};
    let isRegisterMode = false; // Giriş mi, kayıt mı?

    function saveUserData() {
        if (!currentUser) return;
        users[currentUser] = {
            password: users[currentUser].password, // Şifreyi de kaydet
            coin: coin,
            rosterLimit: rosterLimit,
            players: players,
            first11: first11.map(p => p.id), // Sadece ID'leri kaydet
            substitutes: substitutes.map(p => p.id),
            rosterOut: rosterOut.map(p => p.id),
            nextId: nextId
        };
        localStorage.setItem('soccer_users', JSON.stringify(users));
        localStorage.setItem('soccer_last_user', currentUser); // Son kullanıcıyı hatırla
    }

    function loadUserData(username) {
        const userData = users[username];
        if (userData) {
            coin = userData.coin || 100;
            rosterLimit = userData.rosterLimit || 500;
            players = userData.players || [];
            nextId = userData.nextId || 1;

            // Oyuncu listelerini ID'lere göre doldur
            first11 = players.filter(p => userData.first11.includes(p.id));
            substitutes = players.filter(p => userData.substitutes.includes(p.id));
            rosterOut = players.filter(p => userData.rosterOut.includes(p.id));
            
            // Eğer bir oyuncu bir listede yoksa ve diğer listede olması gerekiyorsa fixle
            players.forEach(p => {
                if(!first11.includes(p) && !substitutes.includes(p) && !rosterOut.includes(p)) {
                    rosterOut.push(p); // Varsayılan olarak kadro dışına at
                }
            });

            console.log(`Kullanıcı ${username} için veriler yüklendi.`);
        } else {
            // Yeni kullanıcı veya ilk kez giriş
            coin = 100;
            rosterLimit = 500;
            players = [];
            first11 = [];
            substitutes = [];
            rosterOut = [];
            nextId = 1;
            console.log(`Yeni kullanıcı ${username} için varsayılan veriler oluşturuldu.`);
        }
        updateCoin();
        updateRosterLists();
    }

    function validatePassword(password) {
        // En az 8, en fazla 16 karakter
        if (password.length < 8 || password.length > 16) {
            return false;
        }
        // En az bir özel karakter
        const specialCharRegex = /[!@#$%^&*()_+{}\[\]:";'<>,.?/`~-]/;
        if (!specialCharRegex.test(password)) {
            return false;
        }
        // En az bir rakam
        const digitRegex = /\d/;
        if (!digitRegex.test(password)) {
            return false;
        }
        // En az bir büyük harf
        const upperCaseRegex = /[A-Z]/;
        if (!upperCaseRegex.test(password)) {
            return false;
        }
        // En az bir küçük harf
        const lowerCaseRegex = /[a-z]/;
        if (!lowerCaseRegex.test(password)) {
            return false;
        }
        return true;
    }

    function handleLogin() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (!username || !password) {
            customAlert("Uyarı", translations[currentLanguage].fillAllFields);
            return;
        }

        if (isRegisterMode) {
            // Kayıt Modu
            if (users[username]) {
                customAlert("Hata", translations[currentLanguage].userExists);
            } else {
                if (!validatePassword(password)) {
                    customAlert("Hata", translations[currentLanguage].passwordRequirements);
                    return;
                }
                users[username] = { password: password }; // Yeni kullanıcı oluştur
                localStorage.setItem('soccer_users', JSON.stringify(users));
                customAlert("Başarılı", translations[currentLanguage].registrationSuccess, () => {
                    // Kayıttan sonra otomatik olarak giriş moduna geç
                    isRegisterMode = false;
                    toggleLoginRegister();
                });
            }
        } else {
            // Giriş Modu
            if (users[username] && users[username].password === password) {
                currentUser = username;
                loginScreen.style.display = 'none';
                navBar.style.display = 'flex';
                mainContent.style.display = 'flex';
                loadUserData(currentUser);
                updateTextContent(); // Dil ve diğer metinleri güncelle
                customAlert("Başarılı", translations[currentLanguage].loggedIn);
                showSection("rosterSection"); // Giriş sonrası kadro ekranına yönlendir
            } else {
                customAlert("Hata", translations[currentLanguage].invalidCredentials);
            }
        }
    }

    function toggleLoginRegister() {
        isRegisterMode = !isRegisterMode;
        loginButton.textContent = isRegisterMode ? translations[currentLanguage].registerButton : translations[currentLanguage].loginButton;
        registerPrompt.textContent = isRegisterMode ? translations[currentLanguage].loginPrompt : translations[currentLanguage].register;
        document.getElementById("loginToggle").childNodes[0].nodeValue = isRegisterMode ? translations[currentLanguage].alreadyAccount : translations[currentLanguage].noAccount;
        document.querySelector("#loginScreen h2").textContent = isRegisterMode ? translations[currentLanguage].registerTitle : translations[currentLanguage].loginTitle;
    }

    loginButton.onclick = handleLogin;
    registerPrompt.onclick = toggleLoginRegister;

    logoutButton.onclick = () => {
        saveUserData(); // Mevcut veriyi kaydet
        currentUser = null;
        localStorage.removeItem('soccer_last_user'); // Son kullanıcıyı unut
        location.reload(); // Sayfayı yenileyerek giriş ekranına dön
    };

    deleteAccountButton.onclick = () => {
        if (!currentUser) return;
        customAlert("Onay", translations[currentLanguage].accountDeletedConfirm, () => {
            delete users[currentUser];
            localStorage.setItem('soccer_users', JSON.stringify(users));
            customAlert("Başarılı", translations[currentLanguage].accountDeleted, () => {
                currentUser = null;
                localStorage.removeItem('soccer_last_user');
                location.reload();
            });
        });
    };

    // --- Genel Arayüz ve Navigasyon Fonksiyonları ---
    function showSection(sectionId) {
        if (matchActive && sectionId !== 'matchSection') { // Maç aktifken menüden çıkmaya çalışırsa
            customAlert("Uyarı", translations[currentLanguage].matchExitConfirm, (confirmed) => {
                if (confirmed) {
                    endMatch(true); // Maçı bitir ve tam ekrandan çık
                    _showSectionLogic(sectionId); // Onaylarsa sekmeyi değiştir
                }
            });
            return; // Kullanıcı vazgeçerse hiçbir şey yapma
        }
        _showSectionLogic(sectionId);
    }

    function _showSectionLogic(sectionId) {
        document.querySelectorAll('section').forEach(s => s.classList.remove("active"));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove("active"));

        document.getElementById(sectionId).classList.add("active");
        document.getElementById(`btn${sectionId.replace('Section', '')}`).classList.add("active");
        
        // Eğer maç ekranına geçilmiyorsa maç alanı gizli kalsın
        if (sectionId !== 'matchSection') {
            matchArea.style.display = 'none';
            matchInfo.style.display = 'none';
            matchOptions.style.display = 'flex';
            restartMatchBtn.style.display = 'none';
            exitMatchBtn.style.display = 'none';
        } else { // Maç ekranına geçildiğinde (ama maç başlamadıysa)
            if(!matchActive) { // Maç aktif değilse seçenekleri göster
                matchArea.style.display = 'none';
                matchInfo.style.display = 'none';
                matchOptions.style.display = 'flex';
                restartMatchBtn.style.display = 'none';
                exitMatchBtn.style.display = 'none';
            }
        }
    }


    btnRoster.onclick = () => showSection('rosterSection');
    btnPack.onclick = () => showSection('packSection');
    btnTraining.onclick = () => showSection('trainingSection');
    btnMatch.onclick = () => showSection('matchSection');
    btnSettings.onclick = () => showSection('settingsSection');

    // --- Coin ve Kadro Yönetimi ---
    function updateCoin() {
        coinCountEl.textContent = coin;
    }

    function getPlayerFrameClass(rating) {
        if (rating >= 95) return 'frame-diamond';
        if (rating >= 85) return 'frame-gold';
        if (rating >= 75) return 'frame-silver';
        return 'frame-bronze';
    }

    function createPlayerLi(player, currentListType) {
        const li = document.createElement("li");
        li.className = "player-item";
        li.dataset.playerId = player.id;
        li.onclick = () => showPlayerDetails(player);

        const frameDiv = document.createElement("div");
        frameDiv.className = `player-frame ${getPlayerFrameClass(player.rating)}`;
        li.appendChild(frameDiv);

        const contentDiv = document.createElement("div");
        contentDiv.className = "player-card-content";

        const thumbnailDiv = document.createElement("div");
        thumbnailDiv.className = "player-thumbnail";
        const img = document.createElement("img");
        img.src = player.image || genericPlayerImage;
        thumbnailDiv.appendChild(img);
        contentDiv.appendChild(thumbnailDiv);

        const textInfoDiv = document.createElement("div");
        textInfoDiv.className = "player-text-info";

        const playerNameSpan = document.createElement("span");
        playerNameSpan.className = "player-name";
        playerNameSpan.textContent = player.name;
        textInfoDiv.appendChild(playerNameSpan);

        const playerInfoSpan = document.createElement("span");
        playerInfoSpan.className = "player-info";
        playerInfoSpan.textContent = `${translations[currentLanguage].rating}: ${player.rating}`;
        textInfoDiv.appendChild(playerInfoSpan);
        contentDiv.appendChild(textInfoDiv);
        li.appendChild(contentDiv);

        const actionsDiv = document.createElement("div");
        actionsDiv.className = "player-actions";

        if (currentListType !== 'first11') {
            const toFirst11Btn = document.createElement("button");
            toFirst11Btn.className = "small-btn";
            toFirst11Btn.textContent = translations[currentLanguage].first11;
            toFirst11Btn.onclick = (e) => { e.stopPropagation(); movePlayerToList(player.id, 'first11'); };
            actionsDiv.appendChild(toFirst11Btn);
        }
        if (currentListType !== 'substitutes') {
            const toSubsBtn = document.createElement("button");
            toSubsBtn.className = "small-btn";
            toSubsBtn.textContent = translations[currentLanguage].substitutes;
            toSubsBtn.onclick = (e) => { e.stopPropagation(); movePlayerToList(player.id, 'substitutes'); };
            actionsDiv.appendChild(toSubsBtn);
        }
        if (currentListType !== 'rosterOut') {
            const toRosterOutBtn = document.createElement("button");
            toRosterOutBtn.className = "small-btn";
            toRosterOutBtn.textContent = translations[currentLanguage].rosterOut;
            toRosterOutBtn.onclick = (e) => { e.stopPropagation(); movePlayerToList(player.id, 'rosterOut'); };
            actionsDiv.appendChild(toRosterOutBtn);
        }

        li.appendChild(actionsDiv);
        return li;
    }

    function showPlayerDetails(player) {
        infoPlayerImage.innerHTML = `<img src="${player.image || defaultPlayerImage}" alt="${player.name}"/>`;
        infoPlayerName.textContent = player.name;
        infoPlayerRating.textContent = player.rating;
        infoPlayerGoals.textContent = player.goals;
        infoPlayerAssists.textContent = player.assists;
        playerInfoPanel.classList.add('active');
    }

    function updateRosterLists() {
        first11List.innerHTML = "";
        subsList.innerHTML = "";
        rosterOutList.innerHTML = "";

        first11.forEach(player => first11List.appendChild(createPlayerLi(player, 'first11')));
        substitutes.forEach(player => subsList.appendChild(createPlayerLi(player, 'substitutes')));
        rosterOut.forEach(player => rosterOutList.appendChild(createPlayerLi(player, 'rosterOut')));

        first11CountEl.textContent = first11.length;
        substitutesCountEl.textContent = substitutes.length;
        rosterOutCountEl.textContent = rosterOut.length;
        rosterLimitCountEl.textContent = rosterLimit;

        updateTrainingSelect();
        saveUserData(); // Her liste güncellemesinde kaydet
    }

    function movePlayerToList(playerId, targetListType) {
        const player = players.find(p => p.id === playerId);
        if (!player) return;

        // Mevcut listesinden çıkar
        first11 = first11.filter(p => p.id !== playerId);
        substitutes = substitutes.filter(p => p.id !== playerId);
        rosterOut = rosterOut.filter(p => p.id !== playerId);

        let moved = false;
        if (targetListType === 'first11') {
            if (first11.length < 11) {
                first11.push(player);
                moved = true;
            } else {
                customAlert("Uyarı", translations[currentLanguage].first11Full);
            }
        } else if (targetListType === 'substitutes') {
            if (substitutes.length < 11) {
                substitutes.push(player);
                moved = true;
            } else {
                customAlert("Uyarı", translations[currentLanguage].substitutesFull);
            }
        } else if (targetListType === 'rosterOut') {
            if (rosterOut.length < rosterLimit) {
                rosterOut.push(player);
                moved = true;
            } else {
                customAlert("Uyarı", translations[currentLanguage].rosterLimitFull);
            }
        }
        
        if (!moved) { // Eğer oyuncu taşınamadıysa eski listesine geri koy
            if (first11.find(p => p.id === playerId)) {} // Zaten buradaysa dokunma
            else if (substitutes.find(p => p.id === playerId)) {}
            else if (rosterOut.find(p => p.id === playerId)) {}
            else { // Hiçbir yerde değilse, orijinal olarak nereden geldiğini bulup oraya koymak daha zor, en uygun yere veya rosterOut'a
                 rosterOut.push(player); // Varsayılan olarak rosterOut'a geri koy
            }
        }
        updateRosterLists();
    }

    increaseRosterBtn.onclick = () => {
        if(coin < 100) {
            customAlert("Uyarı", translations[currentLanguage].notEnoughCoin);
            return;
        }
        rosterLimit += 100;
        coin -= 100;
        updateCoin();
        updateRosterLists();
        customAlert("Başarılı", translations[currentLanguage].rosterIncreaseSuccess.replace('{limit}', rosterLimit));
    };

    // --- Paket Açma ---
    leagueSelect.onchange = () => {
        const selectedLeague = leagueSelect.value;
        openPackBtn.disabled = selectedLeague === "";
        packAnim.classList.remove('active');
        packAnimText.textContent = translations[currentLanguage].packOpening;
        packPlayerImage.innerHTML = '';

        if (selectedLeague && ligPaketleri[selectedLeague] && ligPaketleri[selectedLeague].image) {
            packImageContainer.innerHTML = `<img src="${ligPaketleri[selectedLeague].image}" alt="${selectedLeague} Pack"/>`;
        } else {
            packImageContainer.innerHTML = `<span class="placeholder-text">${translations[currentLanguage].packImagePlaceholder || "Paket Resmi"}</span>`;
        }
    };

    function showPackAnimation(playerName, playerRating, playerImage) {
        packAnim.classList.add('active');
        packAnimText.textContent = translations[currentLanguage].packOpening;
        
        // Remove existing frames from previous animations
        packPlayerImage.className = ''; 
        packPlayerImage.innerHTML = `<img src="${playerImage || defaultPlayerImage}" alt="${playerName}"/>`;
        
        // Apply initial style before transition
        packPlayerImage.style.opacity = '0';
        packPlayerImage.style.transform = 'scale(0.5)';

        setTimeout(() => {
            packAnimText.textContent = translations[currentLanguage].congrats.replace('{playerName}', playerName);
            packPlayerImage.className = getPlayerFrameClass(playerRating); // Çerçeveyi uygula
            packPlayerImage.style.opacity = '1';
            packPlayerImage.style.transform = 'scale(1)';
        }, 1500);

        setTimeout(() => {
            packAnim.classList.remove('active');
        }, 4000);
    }

    openPackBtn.onclick = () => {
        if(coin < 100) {
            customAlert("Uyarı", translations[currentLanguage].notEnoughCoin);
            return;
        }
        const lig = leagueSelect.value;
        const pool = ligPaketleri[lig].players;
        if(!pool) {
            customAlert("Uyarı", translations[currentLanguage].selectLeague); // "Lig seçiniz..." için
            return;
        }

        const available = pool.filter(name => !players.some(p => p.name === name));
        if(available.length === 0) {
            customAlert("Uyarı", translations[currentLanguage].allPlayersInLeague);
            return;
        }
        
        if(rosterOut.length >= rosterLimit) {
            customAlert("Uyarı", translations[currentLanguage].rosterFull);
            return;
        }

        coin -= 100;
        updateCoin();

        const selectedName = available[Math.floor(Math.random() * available.length)];
        const newPlayer = {
            id: nextId++,
            name: selectedName,
            rating: Math.floor(Math.random() * 20) + 70, // 70-89 arası
            goals: 0,
            assists: 0,
            image: defaultPlayerImage // Varsayılan oyuncu görseli
        };
        // Özel oyunculara özel görsel ataması (Ronaldo/Messi gibi, eğer isimleri gelirse)
        if (selectedName.includes("Ronaldo")) newPlayer.image = ronaldoImage;
        else if (selectedName.includes("Messi")) newPlayer.image = messiImage;
        else newPlayer.image = genericPlayerImage;


        players.push(newPlayer);
        rosterOut.push(newPlayer);

        showPackAnimation(newPlayer.name, newPlayer.rating, newPlayer.image);

        setTimeout(() => {
            updateRosterLists();
        }, 4000);
    };

    // --- Antrenman Bölümü ---
    function updateTrainingSelect() {
        trainSelect.innerHTML = `<option value="">${translations[currentLanguage].selectPlayer}</option>`;
        players.forEach(p => {
            const option = document.createElement("option");
            option.value = p.id;
            option.textContent = `${p.name} (${translations[currentLanguage].rating}: ${p.rating})`;
            trainSelect.appendChild(option);
        });
        normalTrainBtn.disabled = true;
        playerTrainBtn.disabled = true;
        trainMsg.textContent = "";
    }

    trainSelect.onchange = () => {
        normalTrainBtn.disabled = !trainSelect.value;
        playerTrainBtn.disabled = !trainSelect.value;
        trainMsg.textContent = "";
    };

    normalTrainBtn.onclick = () => {
        const pid = parseInt(trainSelect.value);
        const player = players.find(p => p.id === pid);
        if(!player) return;
        if (player.rating >= 100) {
            trainMsg.style.color = "yellow";
            trainMsg.textContent = translations[currentLanguage].trainMsgMaxRating.replace('{playerName}', player.name);
            return;
        }
        const inc = Math.floor(Math.random() * 3) + 1;
        player.rating = Math.min(100, player.rating + inc);
        trainMsg.style.color = "lightgreen";
        trainMsg.textContent = translations[currentLanguage].trainMsgNormal.replace('{playerName}', player.name).replace('{inc}', inc).replace('{rating}', player.rating);
        updateRosterLists();
        updateTrainingSelect();
    };

    playerTrainBtn.onclick = () => {
        const pid = parseInt(trainSelect.value);
        const player = players.find(p => p.id === pid);
        if(!player) return;
        if (player.rating >= 100) {
            trainMsg.style.color = "yellow";
            trainMsg.textContent = translations[currentLanguage].trainMsgMaxRating.replace('{playerName}', player.name);
            return;
        }
        const inc = Math.floor(Math.random() * 5) + 2;
        player.rating = Math.min(100, player.rating + inc);

        let msg = translations[currentLanguage].trainMsgSpecial.replace('{playerName}', player.name).replace('{inc}', inc).replace('{rating}', player.rating);
        const rand = Math.random();
        if(rand < 0.3) {
            player.goals++;
            msg += " " + translations[currentLanguage].goalScored;
        } else if(rand < 0.5) {
            player.assists++;
            msg += " " + translations[currentLanguage].assistMade;
        }
        trainMsg.style.color = "orange";
        trainMsg.textContent = msg;
        updateRosterLists();
        updateTrainingSelect();
    };

    // --- Maç Modu Değişkenleri ve Fonksiyonları ---
    let matchActive = false;
    let playerPos = {x:0, y:0};
    let botPos = {x:0, y:0};
    let ballPos = {x:0, y:0};
    let ballVelocity = {x:0, y:0};
    const ballBaseSpeedFactor = 3.5; // Topun hızı düşürüldü
    const playerSpeed = 3; // Oyuncu hızı düşürüldü
    const botSpeed = 2.8; // Bot hızı düşürüldü
    let keysPressed = {};
    let power = 0;
    let powerIncreasing = false;
    let isChargingShot = false;

    let playerScore = 0;
    let botScore = 0;
    let matchTime = 120;
    let matchInterval = null;
    let currentMatchMode = '1v1';
    let gameLoopId = null;

    let matchAreaWidth = 0;
    let matchAreaHeight = 0;
    let playerWidth = 0;
    let ballWidth = 0;
    const goalWidth = 25;
    const goalHeight = 200;

    // Oyuncu ve Bot görsellerini güncelle
    function updateCharacterImages() {
        playerEl.innerHTML = `<img src="${playerFigureImage}" alt="Player" style="width:100%; height:100%; object-fit:contain;"/>`;
        botEl.innerHTML = `<img src="${botFigureImage}" alt="Bot" style="width:100%; height:100%; object-fit:contain;"/>`;
    }

    function enterFullscreen() {
        if (matchSection.requestFullscreen) {
            matchSection.requestFullscreen();
        } else if (matchSection.mozRequestFullScreen) {
            matchSection.mozRequestFullScreen();
        } else if (matchSection.webkitRequestFullscreen) {
            matchSection.webkitRequestFullscreen();
        } else if (matchSection.msRequestFullscreen) {
            matchSection.msRequestFullscreen();
        }
        matchSection.classList.add('fullscreen-active');
        exitMatchBtn.style.display = 'block';
    }

    function exitFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        matchSection.classList.remove('fullscreen-active');
        exitMatchBtn.style.display = 'none';
    }

    document.addEventListener('fullscreenchange', (event) => {
        if (!document.fullscreenElement) {
            if (matchActive) {
                endMatch(false); // Tam ekrandan çıkılınca maçı bitir
                showSection('matchSection'); // Maç ekranına geri dön
            }
        }
    });

    function updatePowerBar() {
        powerBar.style.width = power + "%";
        powerBarContainer.style.display = isChargingShot ? 'block' : 'none';
    }

    function updateScoreDisplay() {
        scoreDisplay.textContent = `${translations[currentLanguage].yourTeam} ${playerScore} - ${botScore} ${translations[currentLanguage].botTeam}`;
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(matchTime / 60).toString().padStart(2, '0');
        const seconds = (matchTime % 60).toString().padStart(2, '0');
        timerDisplay.textContent = `${translations[currentLanguage].time}: ${minutes}:${seconds}`;
    }

    function resetBall() {
        ballPos = {
            x: matchAreaWidth / 2 - ballWidth / 2,
            y: matchAreaHeight / 2 - ballWidth / 2
        };
        ballVelocity = {x:0, y:0};
        playerPos = {x: 100, y: matchAreaHeight / 2 - playerWidth / 2};
        botPos = {x: matchAreaWidth - 100 - playerWidth, y: matchAreaHeight / 2 - playerWidth / 2};
        updatePositions();
        matchMsg.textContent = translations[currentLanguage].matchContinue;
        power = 0;
        isChargingShot = false;
        updatePowerBar();
    }

    function checkGoal() {
        const leftGoalX_start = 0;
        const leftGoalX_end = goalWidth;
        const goalY_top = matchAreaHeight / 2 - goalHeight / 2;
        const goalY_bottom = matchAreaHeight / 2 + goalHeight / 2;

        let goalScoredThisFrame = false;

        // Sol kale (Botun kalesi)
        if (ballPos.x <= leftGoalX_end && ballPos.y + ballWidth > goalY_top && ballPos.y < goalY_bottom) {
            if (ballVelocity.x < 0) { // Top kaleye doğru gidiyorsa
                playerScore++;
                updateScoreDisplay();
                matchMsg.textContent = translations[currentLanguage].goal;
                if (currentMatchMode === '11v11' && first11.length > 0) {
                    const scorer = first11[Math.floor(Math.random()*first11.length)];
                    scorer.goals++;
                    updateRosterLists();
                }
                setTimeout(resetBall, 1000); // 1 saniye sonra topu sıfırla
                goalScoredThisFrame = true;
            }
        }

        // Sağ kale (Senin kalen)
        const rightGoalX_start = matchAreaWidth - goalWidth;
        const rightGoalX_end = matchAreaWidth;

        if (ballPos.x + ballWidth >= rightGoalX_start && ballPos.y + ballWidth > goalY_top && ballPos.y < goalY_bottom) {
            if (ballVelocity.x > 0) { // Top kaleye doğru gidiyorsa
                botScore++;
                updateScoreDisplay();
                matchMsg.textContent = translations[currentLanguage].goalConceded;
                setTimeout(resetBall, 1000); // 1 saniye sonra topu sıfırla
                goalScoredThisFrame = true;
            }
        }
        return goalScoredThisFrame;
    }

    function startMatch(mode) {
        if (mode === '11v11' && first11.length < 11) {
            customAlert("Uyarı", translations[currentLanguage].first11Required);
            return;
        }

        currentMatchMode = mode;
        matchActive = true;
        playerScore = 0;
        botScore = 0;
        matchTime = 120;
        updateScoreDisplay();
        updateTimerDisplay();
        matchMsg.textContent = translations[currentLanguage].matchStarted;
        
        matchOptions.style.display = 'none';
        matchArea.style.display = 'block';
        matchInfo.style.display = 'block';
        restartMatchBtn.style.display = 'none';
        
        enterFullscreen();
        
        matchAreaWidth = matchArea.clientWidth;
        matchAreaHeight = matchArea.clientHeight;
        playerWidth = playerEl.clientWidth;
        ballWidth = ballEl.clientWidth;

        resetBall();
        updateCharacterImages(); // Karakter görsellerini başlat

        clearInterval(matchInterval);
        matchInterval = setInterval(() => {
            matchTime--;
            updateTimerDisplay();
            if (matchTime <= 0) {
                endMatch(true);
            }
        }, 1000);

        window.addEventListener("keydown", keyDownHandler);
        window.addEventListener("keyup", keyUpHandler);

        if (!gameLoopId) {
            gameLoopId = requestAnimationFrame(gameLoop);
            requestAnimationFrame(joystickLoop);
        }
    }

    start1v1MatchBtn.onclick = () => startMatch('1v1');
    start11v11MatchBtn.onclick = () => startMatch('11v11');
    restartMatchBtn.onclick = () => {
        showSection('matchSection');
    };
    exitMatchBtn.onclick = () => {
        customAlert("Onay", translations[currentLanguage].matchExitConfirm, () => {
            endMatch(true);
            showSection('matchSection');
        });
    };


    function endMatch(exitFullScreenOnEnd) {
        if (!matchActive) return;
        matchActive = false;
        clearInterval(matchInterval);
        cancelAnimationFrame(gameLoopId);
        gameLoopId = null;
        
        window.removeEventListener("keydown", keyDownHandler);
        window.removeEventListener("keyup", keyUpHandler);
        
        let finalMsg = "";
        if (playerScore > botScore) {
            finalMsg = translations[currentLanguage].matchWin;
            coin += 200;
        } else if (botScore > playerScore) {
            finalMsg = translations[currentLanguage].matchLose;
        } else {
            finalMsg = translations[currentLanguage].matchDraw;
            coin += 50;
        }
        updateCoin();
        matchMsg.textContent = finalMsg + " " + translations[currentLanguage].restartMatchPrompt;
        matchArea.style.display = 'none';
        matchInfo.style.display = 'block';
        restartMatchBtn.style.display = 'block';
        power = 0;
        isChargingShot = false;
        updatePowerBar();

        if (exitFullScreenOnEnd) {
            exitFullscreen();
            matchSection.classList.remove("fullscreen-active");
        }
        saveUserData(); // Maç bitince veriyi kaydet
    }

    function updatePositions() {
        playerEl.style.left = playerPos.x + "px";
        playerEl.style.top = playerPos.y + "px";
        botEl.style.left = botPos.x + "px";
        botEl.style.top = botPos.y + "px";
        ballEl.style.left = ballPos.x + "px";
        ballEl.style.top = ballPos.y + "px";
    }

    function keyDownHandler(e) {
        if(!matchActive) return;
        keysPressed[e.key.toLowerCase()] = true;
        if(e.key === " " && !isChargingShot) {
            e.preventDefault();
            startPowerCharge();
        }
    }
    function keyUpHandler(e) {
        if(!matchActive) return;
        keysPressed[e.key.toLowerCase()] = false;
        if(e.key === " ") {
            stopPowerCharge();
        }
    }

    let powerChargeInterval = null;
    function startPowerCharge() {
        isChargingShot = true;
        powerIncreasing = true;
        power = 0;
        powerChargeInterval = setInterval(() => {
            power += 3;
            if(power > 100) power = 0;
            updatePowerBar();
        }, 30);
    }
    function stopPowerCharge() {
        if(!isChargingShot) return;

        isChargingShot = false;
        if(powerIncreasing) {
            powerIncreasing = false;
            clearInterval(powerChargeInterval);
            shootBall(power);
            power = 0;
            updatePowerBar();
        }
    }

    function shootBall(power) {
        const playerCenter = {
            x: playerPos.x + playerWidth / 2,
            y: playerPos.y + playerWidth / 2
        };
        const ballCenter = {
            x: ballPos.x + ballWidth / 2,
            y: ballPos.y + ballWidth / 2
        };

        const distance = Math.sqrt(
            Math.pow(playerCenter.x - ballCenter.x, 2) +
            Math.pow(playerCenter.y - ballCenter.y, 2)
        );
        
        const effectiveRange = playerWidth / 2 + ballWidth / 2 + 10;

        if (distance < effectiveRange) {
            const playerRatingAvg = currentMatchMode === '11v11' && first11.length > 0
                ? first11.reduce((a,b) => a + b.rating, 0) / first11.length
                : 80;

            const shotStrength = (power / 100) * ballBaseSpeedFactor * (1 + (playerRatingAvg - 70) / 100 * 0.05);
            
            const angle = Math.atan2(ballCenter.y - playerCenter.y, ballCenter.x - playerCenter.x);
            ballVelocity.x = Math.cos(angle) * shotStrength;
            ballVelocity.y = Math.sin(angle) * shotStrength;

            matchMsg.textContent = translations[currentLanguage].shot.replace('{power}', power.toFixed(0));

            ballEl.classList.add('shot-anim');
            setTimeout(() => {
                ballEl.classList.remove('shot-anim');
            }, 200);

        } else {
            matchMsg.textContent = translations[currentLanguage].tooFar;
        }
    }

    function botMove() {
        if(!matchActive) return;

        const botCenter = {
            x: botPos.x + playerWidth / 2,
            y: botPos.y + playerWidth / 2
        };
        const ballCenter = {
            x: ballPos.x + ballWidth / 2,
            y: ballPos.y + ballWidth / 2
        };

        let targetX = ballPos.x;
        let targetY = ballPos.y;

        const botToBallDist = Math.sqrt(
            Math.pow(botCenter.x - ballCenter.x, 2) +
            Math.pow(botCenter.y - ballCenter.y, 2)
        );
        const botShootRange = playerWidth / 2 + ballWidth / 2 + 15;

        if (botToBallDist < botShootRange && ballVelocity.x === 0 && ballVelocity.y === 0) {
            const goalX = 0;
            const goalY = matchAreaHeight / 2;

            const shotDx = goalX - ballCenter.x;
            const shotDy = goalY - ballCenter.y;
            const shotDist = Math.sqrt(shotDx * shotDx + shotDy * shotDy);
            
            const botShotPower = (Math.random() * 0.5 + 0.5) * ballBaseSpeedFactor;
            ballVelocity.x = (shotDx / shotDist) * botShotPower;
            ballVelocity.y = (shotDy / shotDist) * botShotPower;

            ballEl.classList.add('shot-anim');
            setTimeout(() => {
                ballEl.classList.remove('shot-anim');
            }, 200);

        } else {
            const dx = targetX - botPos.x;
            const dy = targetY - botPos.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if(dist > 5) {
                botPos.x += (dx/dist) * botSpeed;
                botPos.y += (dy/dist) * botSpeed;
            }
        }

        botPos.x = Math.max(matchAreaWidth / 2, Math.min(matchAreaWidth - playerWidth, botPos.x));
        botPos.y = Math.min(Math.max(0, botPos.y), matchAreaHeight - playerWidth);

        updatePositions();
    }

    function checkCollision(obj1Pos, obj1Size, obj2Pos, obj2Size) {
        const obj1Center = { x: obj1Pos.x + obj1Size / 2, y: obj1Pos.y + obj1Size / 2 };
        const obj2Center = { x: obj2Pos.x + obj2Size / 2, y: obj2Pos.y + obj2Size / 2 };

        const dx = obj1Center.x - obj2Center.x;
        const dy = obj1Center.y - obj2Center.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < (obj1Size / 2 + obj2Size / 2);
    }

    function moveBall() {
        if (!matchActive) return;

        ballPos.x += ballVelocity.x;
        ballPos.y += ballVelocity.y;

        // Sınır çarpışmaları
        if (ballPos.x <= 0) {
            ballPos.x = 0;
            ballVelocity.x *= -0.8;
        } else if (ballPos.x + ballWidth >= matchAreaWidth) {
            ballPos.x = matchAreaWidth - ballWidth;
            ballVelocity.x *= -0.8;
        }

        if (ballPos.y <= 0) {
            ballPos.y = 0;
            ballVelocity.y *= -0.8;
        } else if (ballPos.y + ballWidth >= matchAreaHeight) {
            ballPos.y = matchAreaHeight - ballWidth;
            ballVelocity.y *= -0.8;
        }

        ballVelocity.x *= 0.98;
        ballVelocity.y *= 0.98;

        if (Math.abs(ballVelocity.x) < 0.1) ballVelocity.x = 0;
        if (Math.abs(ballVelocity.y) < 0.1) ballVelocity.y = 0;

        if (checkCollision(playerPos, playerWidth, ballPos, ballWidth) && !isChargingShot) {
            const angle = Math.atan2(ballPos.y - playerPos.y, ballPos.x - playerPos.x);
            ballVelocity.x = Math.cos(angle) * (ballBaseSpeedFactor * 0.4);
            ballVelocity.y = Math.sin(angle) * (ballBaseSpeedFactor * 0.4);
        }

        if (checkCollision(botPos, playerWidth, ballPos, ballWidth) && ballVelocity.x === 0 && ballVelocity.y === 0) { // Bot topa hareketsizse çarpışma
            const angle = Math.atan2(ballPos.y - botPos.y, ballPos.x - botPos.x);
            ballVelocity.x = Math.cos(angle) * (ballBaseSpeedFactor * 0.3);
            ballVelocity.y = Math.sin(angle) * (ballBaseSpeedFactor * 0.3);
        }

        updatePositions();
    }

    function gameLoop() {
        if(!matchActive) {
             gameLoopId = null;
             return;
        }
        
        let moveX = 0;
        let moveY = 0;

        if(keysPressed["w"] || keysPressed["arrowup"]) moveY -= playerSpeed;
        if(keysPressed["s"] || keysPressed["arrowdown"]) moveY += playerSpeed;
        if(keysPressed["a"] || keysPressed["arrowleft"]) moveX -= playerSpeed;
        if(keysPressed["d"] || keysPressed["arrowright"]) moveX += playerSpeed;

        playerPos.x += moveX;
        playerPos.y += moveY;

        playerPos.x = Math.min(Math.max(0, playerPos.x), matchAreaWidth - playerWidth);
        playerPos.y = Math.min(Math.max(0, playerPos.y), matchAreaHeight - playerWidth);
        
        playerPos.x = Math.min(matchAreaWidth / 2 - playerWidth, Math.max(0, playerPos.x));

        botMove();
        moveBall();
        checkGoal();

        gameLoopId = requestAnimationFrame(gameLoop);
    }

    let joystickActive = false;
    let joystickCenter = {x: 0, y: 0};
    let joystickPos = {x: 0, y: 0};

    joystickContainer.addEventListener("pointerdown", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        joystickActive = true;
        const rect = joystickContainer.getBoundingClientRect();
        joystickCenter = {x: rect.width / 2, y: rect.height / 2};
        moveJoystick(e);
    });
    window.addEventListener("pointerup", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        joystickActive = false;
        joystick.style.left = joystickCenter.x - joystick.clientWidth/2 + "px";
        joystick.style.top = joystickCenter.y - joystick.clientHeight/2 + "px";
        joystickPos = {x: 0, y: 0};
    });
    window.addEventListener("pointermove", (e) => {
        if(!joystickActive || !matchActive) return;
        e.preventDefault();
        moveJoystick(e);
    });

    function moveJoystick(e) {
        const rect = joystickContainer.getBoundingClientRect();
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;
        const maxDistance = joystickContainer.clientWidth/2;
        let dx = x - maxDistance;
        let dy = y - maxDistance;

        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist > maxDistance) {
            dx = dx * maxDistance / dist;
            dy = dy * maxDistance / dist;
        }

        joystick.style.left = (maxDistance + dx - joystick.clientWidth/2) + "px";
        joystick.style.top = (maxDistance + dy - joystick.clientHeight/2) + "px";
        joystickPos = {x: dx / maxDistance, y: dy / maxDistance};
    }

    let joystickLoopId = null;
    function joystickLoop() {
        if(!matchActive) {
            joystickLoopId = null;
            return;
        }
        playerPos.x += joystickPos.x * playerSpeed;
        playerPos.y += joystickPos.y * playerSpeed;

        playerPos.x = Math.min(Math.max(0, playerPos.x), matchAreaWidth - playerWidth);
        playerPos.y = Math.min(Math.max(0, playerPos.y), matchAreaHeight - playerWidth);
        
        playerPos.x = Math.min(matchAreaWidth / 2 - playerWidth, Math.max(0, playerPos.x));

        joystickLoopId = requestAnimationFrame(joystickLoop);
    }

    function updateControlsVisibility() {
        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);
        if(isTouchDevice) {
            joystickContainer.style.display = "block";
            kickBtn.style.display = "block";
        } else {
            joystickContainer.style.display = "none";
            kickBtn.style.display = "none";
        }
    }

    kickBtn.addEventListener("touchstart", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        startPowerCharge();
    }, { passive: false });

    kickBtn.addEventListener("touchend", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        stopPowerCharge();
    }, { passive: false });

    kickBtn.addEventListener("mousedown", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        startPowerCharge();
    });
    kickBtn.addEventListener("mouseup", (e) => {
        if (!matchActive) return;
        e.preventDefault();
        stopPowerCharge();
    });

    // --- Ayarlar ve Temalar ---
    languageSelect.onchange = () => {
        currentLanguage = languageSelect.value;
        updateTextContent();
        updateRosterLists(); // Oyuncu liste butonları için de güncelle
        updateTrainingSelect(); // Antrenman selectbox'ı için de güncelle
        // Maç modundaki metinleri güncelle (eğer aktifse)
        if (matchActive) {
            updateScoreDisplay();
            updateTimerDisplay();
        }
        // Save selected language to local storage
        localStorage.setItem('soccer_language', currentLanguage);
    };

    themeRadios.forEach(radio => {
        radio.addEventListener("change", () => {
            document.body.classList.remove('theme-dark', 'theme-light');
            if(radio.value === "dark" || radio.value === "default") {
                // Varsayılan koyu temayı uygula
            } else if(radio.value === "light") {
                document.body.classList.add('theme-light');
            }
            // Save selected theme to local storage
            localStorage.setItem('soccer_theme', radio.value);
        });
    });

    // --- Başlangıç Yüklemeleri ---
    function initializeGame() {
        // Son giriş yapılan kullanıcıyı kontrol et
        const lastUser = localStorage.getItem('soccer_last_user');
        if (lastUser && users[lastUser]) {
            currentUser = lastUser;
            loginScreen.style.display = 'none';
            navBar.style.display = 'flex';
            mainContent.style.display = 'flex';
            loadUserData(currentUser);
        } else {
            loginScreen.style.display = 'flex';
            navBar.style.display = 'none';
            mainContent.style.display = 'none';
        }

        // Kaydedilen dil ayarını yükle
        const savedLanguage = localStorage.getItem('soccer_language');
        if (savedLanguage && translations[savedLanguage]) {
            currentLanguage = savedLanguage;
            languageSelect.value = savedLanguage;
        }
        updateTextContent(); // Başlangıçta metinleri güncelle

        // Kaydedilen tema ayarını yükle
        const savedTheme = localStorage.getItem('soccer_theme');
        if (savedTheme) {
            const themeRadio = document.getElementById(`theme${savedTheme.charAt(0).toUpperCase() + savedTheme.slice(1)}`);
            if (themeRadio) {
                themeRadio.checked = true;
                themeRadio.dispatchEvent(new Event('change')); // Değişikliği tetikle
            }
        }

        updateControlsVisibility();
        updateRosterLists();
        updateTrainingSelect();

        gameLoopId = requestAnimationFrame(gameLoop);
        joystickLoopId = requestAnimationFrame(joystickLoop);
    }
    
    initializeGame();

})();
</script>

</body>
</html>
